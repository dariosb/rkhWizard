<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>RKH: Trazer Reference Manual</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">RKH
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Trazer Reference Manual </div>  </div>
</div>
<div class="contents">
<div class="textblock"><div class="image">
<img src="trazer.png" alt="trazer.png"/>
</div>
<p><br/>
 Trazer is a visualization tool that works in conjuntion with the RKH framework built in trace facility. Trazer gives the possibility to display selectively the recording of all events of your system, state machines, queues, timers, etc. Trazer helps you to faster troubleshooting especially on complex problems where a debugger is not sufficient, by providing a simple consolidated, human-readable textual output.</p>
<p>Given the RKH cross plataform portability, trace data may come from 8, 16, or 32-bits platforms. In order to that Trazer need to be configured to support this diversity of plataform and the wide range of RKH framework configurations.</p>
<p>This manual includes:</p>
<ul>
<li><a class="el" href="trazer.html#trazer_cfg">Configuration</a></li>
<li><a class="el" href="trazer.html#trazer_human_format">Human readable output</a></li>
<li><a class="el" href="rev_page_trazer.html">Trazer revision history</a></li>
</ul>
<p><br/>
 <hr/>
 <h2><a class="anchor" id="trazer_cfg"></a>
Configuration</h2>
<p>Before using Trazer you must provides the listed configurations:</p>
<ul>
<li><a class="el" href="trazer.html#trazer_command">Command-line parameters</a> to configure comunication link and general options.</li>
<li><a class="el" href="trazer.html#trazer_config">Configuration file</a> ( <a class="el" href="trazer_cfg_.html">"trazer.cfg"</a>) to setup all target dependencies, such as pointer sizes, signal sizes, etc.</li>
<li><a class="el" href="trazer.html#trazer_evtbl">Trace event table</a> trace event table ( <a class="el" href="trazer_evt.html">"trazer.evt"</a>), to define parseable trace events and custom information.</li>
</ul>
<hr/>
 <h2><a class="anchor" id="trazer_command"></a>
Command-line parameters</h2>
<table  summary="Trazer Command Line" cellspacing="4" cellpadding="1" border="0" align="center" valign="middle">
<tr bgcolor="#c8cedc">
<td><b>&#160;Option</b> </td><td><b>&#160;Example</b> </td><td><p class="starttd"><b>&#160;Comments</b> </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#f0f0f0">
<td>-h </td><td>-h </td><td><p class="starttd">Help. Prints the summary of options </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#c0c0c0">
<td>-q </td><td>-q </td><td><p class="starttd">Quiet mode (no stdout output) </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#f0f0f0">
<td>-v </td><td>-v </td><td><p class="starttd">Visualize Traze version and compatibility with RKH framework </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#c0c0c0">
<td>-o </td><td>-o trazer.txt </td><td><p class="starttd">Produce output to the specified file </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#f0f0f0">
<td>-c </td><td>-c COM1 115200 8N1 </td><td><p class="starttd">COM port and baudrate selection. Not compatible with -t, -f </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#c0c0c0">
<td>-t </td><td>-t 6602 </td><td><p class="starttd">TCP/IP server and port number. Not compatible with -c, -f (Not implemented) </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#f0f0f0">
<td>-f </td><td>-f trace.bin </td><td><p class="starttd">File input selection. Not compatible with -c, -t </p>
<p class="endtd"></p>
</td></tr>
</table>
<hr/>
 <h2><a class="anchor" id="trazer_config"></a>
Configuration file</h2>
<p>Traze is designed to work with all possible target CPU, which requires a wide range of configurability. For example, for any given target CPU, Trazer must "know" the size of object pointers, event size, timestamp size and so on. You must to provide this information through <a class="el" href="trazer_cfg_.html">"trazer.cfg"</a>, wich content is summarized in the following table:</p>
<table  summary="Trazer config" cellspacing="4" cellpadding="1" border="0" align="center" valign="middle">
<tr bgcolor="#c8cedc">
<td><b>&#160;Parameter</b> </td><td><b>&#160;Valid Values</b> </td><td><b>&#160;Must match RKH config (<a class="el" href="rkhcfg_8h.html" title="RKH user configuration.">rkhcfg.h</a>)</b> </td><td><p class="starttd"><b>&#160;Comments</b> </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#f0f0f0">
<td><code>TRAZER_SIZEOF_SIG</code>  </td><td>1, 2, 4 </td><td><code><a class="el" href="rkhcfg_8h.html#a7a61737a84aca17e02e898df1caaf668">RKH_SIZEOF_EVENT</a></code>  </td><td><p class="starttd">Event Signal size in bytes. </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#c0c0c0">
<td><code>TRAZER_SIZEOF_TSTAMP</code>  </td><td>1, 2, 4 </td><td><code><a class="el" href="rkhcfg_8h.html#a7578c16664c9e40b84a22e10ec3d44f3">RKH_TRC_SIZEOF_TSTAMP</a></code>  </td><td><p class="starttd">Bytes quantity used by the trace record timestamp. </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#f0f0f0">
<td><code>TRAZER_SIZEOF_POINTER</code>  </td><td>1, 2, 4 </td><td><code><a class="el" href="rkhcfg_8h.html#a6575965e629115f22df236ebc7745925">RKH_TRC_SIZEOF_POINTER</a></code>  </td><td><p class="starttd">Size in bytes of void pointer. </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#c0c0c0">
<td><code>TRAZER_SIZEOF_NTIMER</code>  </td><td>1, 2, 4 </td><td><code><a class="el" href="rkhcfg_8h.html#abac16b1447ced1d3c71b6a879c6d3b34">RKH_TIM_SIZEOF_NTIMER</a></code>  </td><td><p class="starttd">Dynamic range of time delays measured in ticks and expresed in bytes. </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#f0f0f0">
<td><code>TRAZER_SIZEOF_NBLOCK</code>  </td><td>1, 2, 4 </td><td><code><a class="el" href="rkhcfg_8h.html#a06bace2aeb87b701aff42436ff849cf4">RKH_MP_SIZEOF_NBLOCK</a></code>  </td><td><p class="starttd">Size in bytes of number of memory block size. </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#c0c0c0">
<td><code>TRAZER_SIZEOF_NELEM</code>  </td><td>1, 2, 4 </td><td><code><a class="el" href="rkhcfg_8h.html#ae44948ec8fc66854ec71c3d9b8a8ddd9">RKH_RQ_SIZEOF_NELEM</a></code>  </td><td><p class="starttd">Maximum number of elements in bytes that any queue can contain. </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#f0f0f0">
<td><code>TRAZER_SIZEOF_ESIZE</code>  </td><td>1, 2, 4 </td><td><code><a class="el" href="rkhcfg_8h.html#a68728a657dc1d739aae87ec0b14cf9f4">RKH_SIZEOF_ESIZE</a></code>  </td><td><p class="starttd">Data type of event size, in bytes. </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#c0c0c0">
<td><code>TRAZER_EN_NSEQ</code>  </td><td>0, 1 </td><td><code><a class="el" href="rkhcfg_8h.html#af7c0f4d0fca41d244dc0d41cfad7300e">RKH_TRC_EN_NSEQ</a></code>  </td><td><p class="starttd">Enable/Disable Number of Sequence use in trace stream. </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#f0f0f0">
<td><code>TRAZER_EN_CHK</code>  </td><td>0, 1 </td><td><code><a class="el" href="rkhcfg_8h.html#a24065b97a16aeb6cca1b822764d7a35c">RKH_TRC_EN_CHK</a></code>  </td><td><p class="starttd">Enable/Disable Checksum use in trace stream. </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#c0c0c0">
<td><code>TRAZER_EN_TSTAMP</code>  </td><td>0, 1 </td><td><code><a class="el" href="rkhcfg_8h.html#a293a5e3a0cb5a241c64793f06ac653d9">RKH_TRC_EN_TSTAMP</a></code>  </td><td><p class="starttd">Enable/Disable Time stamp use in trace stream. </p>
<p class="endtd"></p>
</td></tr>
</table>
<p>Your must ensure that Trazer configuration, match exactly with the target system under test, otherwise will be unable to parse the trace stream, and these errors would be shown: </p>
<table  summary="Trazer errors" cellspacing="4" cellpadding="1" border="0" align="center" valign="middle">
<tr bgcolor="#f0f0f0">
<td>***** Stream Checksum Error  </td></tr>
<tr bgcolor="#c0c0c0">
<td>***** May be have lost trace info, sequence are not correlatives  </td></tr>
</table>
<hr/>
 <h2><a class="anchor" id="trazer_evtbl"></a>
Trace event table</h2>
<p>In order to support future events definitions from new RKH releases, and potential user defined traces, each event must be defined into <a class="el" href="trazer_evt.html">"trazer.evt"</a> file to be recognized by Trazer. Each particular event is defined as shown in the table below:</p>
<table  summary="Trazer config" cellspacing="4" cellpadding="1" border="0" align="center" valign="middle">
<tr bgcolor="#c8cedc">
<td><b>&#160;Field</b> </td><td><b>&#160;Example</b> </td><td><p class="starttd"><b>&#160;Description</b> </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#f0f0f0">
<td>Event </td><td>RKH_TRCE_MP_INIT </td><td><p class="starttd">Event ID, must be according to <a class="el" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8a" title="RKH trace events.">RKH_TRC_EVENTS</a> definition in <a class="el" href="rkhtrc_8h.html" title="Platform-independent interface for RKH trace facility.">rkhtrc.h</a> </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#c0c0c0">
<td>Group </td><td>MP </td><td><p class="starttd">RKH service that generate the event. </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#f0f0f0">
<td>Name </td><td>INIT </td><td><p class="starttd">Custom Alias for the event </p>
<p class="endtd"></p>
</td></tr>
<tr bgcolor="#c0c0c0">
<td>Comment </td><td>Memory Pool Init </td><td>Optional descriptive comment.  </td></tr>
</table>
<p>Trazer user may can change <b>Alias</b>, <b>Comment</b> and <b>Group</b> fields to customize the visualization output. In the instrumented application two particular trace events could be used to better trace visualization, <a class="el" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aab88f505e35ee563b56c01693e2ed5b45">RKH_TRCE_OBJ</a> and <a class="el" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aaa17b33a66d33f9501db6b7f7a7c5a574">RKH_TRCE_SIG</a>.</p>
<p><a class="el" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aab88f505e35ee563b56c01693e2ed5b45">RKH_TRCE_OBJ</a>: <br/>
<br/>
 Associates the address of the object, in memory with its symbolic name. Using the <a class="el" href="rkhtrc_8h.html#a34c7d44996769e01900b01d23a584af8">RKH_TRCR_RKH_OBJ()</a> macro in application source code looks like:</p>
<div class="fragment"><pre class="fragment">...
    <span class="keyword">static</span> <span class="keywordtype">int</span> g_status; 
    <span class="keyword">static</span> <a class="code" href="struct_r_k_h_t___t.html" title="Defines the data structure used to maintain information that allows the timer-handling facility to up...">RKHT_T</a> tdll; 

(1) <a class="code" href="rkhtrc_8h.html#a34c7d44996769e01900b01d23a584af8">RKH_TRCR_RKH_OBJ</a>( &amp;g_status );
(2) <a class="code" href="rkhtrc_8h.html#a34c7d44996769e01900b01d23a584af8">RKH_TRCR_RKH_OBJ</a>( &amp;tdll );
</pre></div><p>Explanation:</p>
<ul>
<li>(1-2) The <a class="el" href="rkhtrc_8h.html#a34c7d44996769e01900b01d23a584af8">RKH_TRCR_RKH_OBJ()</a> macro associates the object memory address with its symbolic name. This macro also performs the trace event recording to local stream.</li>
</ul>
<p><a class="el" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aaa17b33a66d33f9501db6b7f7a7c5a574">RKH_TRCE_SIG</a>: <br/>
<br/>
 Associates the numerical value of the event signal to the symbolic name of the signal. Using the <a class="el" href="rkhtrc_8h.html#a34c7d44996769e01900b01d23a584af8">RKH_TRCR_RKH_OBJ()</a> macro in application source code looks like:</p>
<div class="fragment"><pre class="fragment">    <span class="comment">// in the dedicated application header file resides the signal enumeration</span>

    <span class="keyword">enum</span>
    {
        ...
        PWR_FAIL,
        PRESS_ENTER,
        ...
    };

    <span class="comment">// frequently, the macro RKH_TRCR_RKH_SIG() is used in the \b main.c file.</span>

(1) <a class="code" href="rkhtrc_8h.html#a71ab3ab8b73cb7f259941c163cb747b8">RKH_TRCR_RKH_SIG</a>( PWR_FAIL );
(2) <a class="code" href="rkhtrc_8h.html#a71ab3ab8b73cb7f259941c163cb747b8">RKH_TRCR_RKH_SIG</a>( PRESS_ENTER );
</pre></div><p>Explanation:</p>
<ul>
<li>(1-2) The <a class="el" href="rkhtrc_8h.html#a71ab3ab8b73cb7f259941c163cb747b8">RKH_TRCR_RKH_SIG()</a> macro associates the numerical value of the event signal to the symbolic name of the signal. This macro also performs the trace event recording to local stream.</li>
</ul>
<p>RKH user must generate this particulars trace events as described in RKHTRACE and Trazer will take care of reemplacing the numeric values by the user definition.</p>
<hr/>
 <h2><a class="anchor" id="trazer_human_format"></a>
Human readable output</h2>
<p>Trazer is a console program that converts the trace stream data in a human-readable format. Following is shown how its output looks like.<br/>
 Trazer start showing version and compatibility with RKH framework, below are displayed the current Trazer configuration. For this example the trace.bin is used as trace data source.<br/>
 Each identified trace show:<br/>
</p>
<ul>
<li><b>Timestamp</b>, in CPU ticks. The number of bytes used by the timestamp is configurable by the macro TRAZER_SIZEOF_TSTAMP. See the TRAZER_EN_TSTAMP option.</li>
</ul>
<ul>
<li><b>Sequence number</b>, the target component increments this number for every frame inserted into the stream. The sequence number allows the trazer tool to detect any data discontinuities. See the <b>TRAZER_EN_NSEQ</b> option.</li>
</ul>
<ul>
<li><b>System service group name</b>.</li>
</ul>
<ul>
<li><b>Trace event alias</b>, which is one of the predefined RKH records or an application-specific record. See the <a class="el" href="trazer_evt.html">"trazer.evt"</a> file and <a class="el" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8a" title="RKH trace events.">RKH_TRC_EVENTS</a>.</li>
</ul>
<ul>
<li><b>Args</b>, data asociated with the event.</li>
</ul>
<ul>
<li>Comment.</li>
</ul>
<p>Sequences 4, 5 and 6 are examples of <a class="el" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aab88f505e35ee563b56c01693e2ed5b45">RKH_TRCE_OBJ</a> and <a class="el" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aaa17b33a66d33f9501db6b7f7a7c5a574">RKH_TRCE_SIG</a> events. After, sequences 16, 17, 32 and 33, show how Trazer identify object address and signal number replacing them by its symbolic representation. In case that no symbolic representation has been defined for a particular object, (null) will be shown, and in same manner the numeric value for signals.</p>
<div class="fragment"><pre class="fragment">

TRAZER Visualization Tool V1.0 compatible with RKH V2.0
Date = Apr  7 2012 01:46:48

Trace Setup

   Trace events quantity = 45
   TRAZER_SIZEOF_SIG     = 1
   TRAZER_SIZEOF_TSTAMP  = 4
   TRAZER_SIZEOF_POINTER = 4
   TRAZER_SIZEOF_NTIMER  = 2
   TRAZER_SIZEOF_NBLOCK  = 1
   TRAZER_SIZEOF_NELEM   = 1
   TRAZER_SIZEOF_ESIZE   = 2
   TRAZER_EN_NSEQ        = 1
   TRAZER_EN_CHK         = 1
   TRAZER_EN_TSTAMP      = 1
   RKH_TRC_ALL           = 1
   RKH_TRC_EN_MP         = 0
   RKH_TRC_EN_RQ         = 0
   RKH_TRC_EN_SMA        = 0
   RKH_TRC_EN_TIM        = 0
   RKH_TRC_EN_SM         = 0
   RKH_TRC_EN_RKH        = 0


-------- Parsing trace stream from file trace.bin --------

        84 [  0] MP  | INIT            : mp=(null), nblock=16  : Memory Pool Init
        84 [  1] RKH | EPOOL_REG       : epix =1, ssize=64, esize=4
        84 [  2] MP  | INIT            : mp=(null), nblock=4  : Memory Pool Init
        84 [  3] RKH | EPOOL_REG       : epix =2, ssize=32, esize=8
        84 [  4] RKH | SYM_OBJ         : obj=0x01091780, sym=&amp;rkheplist[0]
        84 [  5] RKH | SYM_OBJ         : obj=0x01091794, sym=&amp;rkheplist[1]
        84 [  6] RKH | SYM_SIG         : sig=1, sym=ONE
        84 [  7] RQ  | INIT            : rq=(null), sma=(null), nelem=4
        84 [  8] SMA | REGISTER        : sma=(null), prio=0
        84 [  9] SM  | INIT            : sma=(null), istate=(null)
        84 [ 10] TIM | INIT            : timer=(null), sig=(null)
        84 [ 11] SM  | ENTRY_STATE     : sma=(null), state=(null)
        84 [ 12] SM  | ENTRY_STATE     : sma=(null), state=(null)
        84 [ 13] SM  | ENTRY_STATE     : sma=(null), state=(null)
        84 [ 14] SMA | ACTIVATE        : sma=(null)
        86 [ 15] RKH | ENTER           :
      1509 [ 16] MP  | GET             : mp=&amp;rkheplist[1], nfree=3  : Memory Pool Get
      1509 [ 17] RKH | ALLOC_EVENT     : esize=6, sig=ONE
      1509 [ 18] RQ  | POST_FIFO       : rq=(null), nused=1
      1509 [ 19] SMA | POST_FIFO       : sma=(null), sig=ONE
      1509 [ 20] RQ  | GET_LAST        : rq=(null)
      1509 [ 21] SMA | GET_EVENT       : sma=(null), sig=ONE
      1509 [ 22] SM  | DISPATCH        : sma=(null), sig=ONE
      1509 [ 23] SM  | TRANSITION      : sma=(null), sstate=(null), tstate=(null)
      1509 [ 24] SM  | COMP_STATE      : sma=(null), state=(null)
      1509 [ 25] SM  | NUM_EN_EX       : sma=(null), nentry=1, nexit=1
      1509 [ 26] SM  | EXIT_STATE      : sma=(null), state=(null)
      1509 [ 27] SM  | NUM_TRN_ACT     : sma=(null), ntrnaction=1
      1509 [ 28] SM  | ENTRY_STATE     : sma=(null), state=(null)
      1509 [ 29] SM  | CURRENT_STATE   : sma=(null), state=(null)
      1509 [ 30] SM  | DISPATCH_RCODE  : sma=(null), retcode=RKH_OK
      1509 [ 31] RKH | GC_RECYCLE      : sig=ONE
      1509 [ 32] MP  | PUT             : mp=&amp;rkheplist[1], nfree=4
      1905 [ 33] MP  | GET             : mp=&amp;rkheplist[1], nfree=3  : Memory Pool Get
      1905 [ 34] RKH | ALLOC_EVENT     : esize=6, sig=(null)
      1905 [ 35] RQ  | POST_FIFO       : rq=(null), nused=1

</pre></div> </div></div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 9 2012 13:05:37 for RKH by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
