<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>RKH: &quot;trazer.c&quot;</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">RKH
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_usage.html">Representing a state machine: step by step</a>      </li>
      <li class="navelem"><a class="el" href="preparing.html">Preparing the application files</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">"trazer.c" </div>  </div>
</div>
<div class="contents">
<div class="textblock"><div class="fragment"><pre class="fragment"><span class="comment">/*</span>
<span class="comment">    file: trazer.c</span>
<span class="comment">    Last updated for version: 2.0</span>
<span class="comment">    Date of the last update:  Mar 19, 2012</span>
<span class="comment"></span>
<span class="comment">    Copyright (C) 2010 Leandro Francucci. All rights reserved.</span>
<span class="comment"></span>
<span class="comment">    RKH is free software: you can redistribute it and/or modify</span>
<span class="comment">    it under the terms of the GNU General Public License as published by</span>
<span class="comment">    the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment">    (at your option) any later version.</span>
<span class="comment"></span>
<span class="comment">  RKH is distributed in the hope that it will be useful,</span>
<span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment">  GNU General Public License for more details.</span>
<span class="comment"></span>
<span class="comment">  You should have received a copy of the GNU General Public License</span>
<span class="comment">  along with RKH, see copying.txt file.</span>
<span class="comment"></span>
<span class="comment"> Contact information:</span>
<span class="comment"> RKH web site:  http://</span>
<span class="comment"> e-mail:            francuccilea@gmail.com</span>
<span class="comment"> */</span>


<span class="preprocessor">#include &quot;<a class="code" href="rkhtrc_8h.html" title="Platform-independent interface for RKH trace facility.">rkhtrc.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="rkh_8h.html" title="RKH platform-independent interface.">rkh.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="rkhcfg_8h.html" title="RKH user configuration.">rkhcfg.h</a>&quot;</span>
<span class="preprocessor">#include &quot;my.h&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="rkhtim_8h.html" title="Platform-independent interface for supporting software timer services.">rkhtim.h</a>&quot;</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>


<a class="code" href="rkhassert_8h.html#a57dfc35a74e5e399f3c6c5f0bad6e6ba" title="This macro appears at the top of each C/C++ source file defining a name for that file, by means of __FILE__ compiler directive.">RKH_THIS_MODULE</a>


<span class="preprocessor">#define TRAZER_EN           (RKH_TRC_EN == 1 &amp;&amp; ( RKH_TRC_ALL == 1 ||       \</span>
<span class="preprocessor">                            RKH_TRC_EN_MP == 1 || RKH_TRC_EN_RQ == 1 ||     \</span>
<span class="preprocessor">                            RKH_TRC_EN_SMA == 1 || RKH_TRC_EN_TIM == 1 ||   \</span>
<span class="preprocessor">                            RKH_TRC_EN_SM == 1 || RKH_TRC_EN_RKH == 1 ))</span>
<span class="preprocessor"></span>
<span class="preprocessor">#define TRAZER_NTRE         RKH_TRCE_USER</span>
<span class="preprocessor"></span><span class="preprocessor">#define TRAZER_NTRG         RKH_TRCG_NGROUP</span>
<span class="preprocessor"></span><span class="preprocessor">#define CC(s)               ((const char*)(s))</span>
<span class="preprocessor"></span>

<span class="comment">/*</span>
<span class="comment">    Application dependent macros and typedefs</span>
<span class="comment"> */</span>

<span class="preprocessor">#define TRAZER_SIZEOF_SIG           RKH_SIZEOF_EVENT/8</span>
<span class="preprocessor"></span><span class="preprocessor">#define TRAZER_SIZEOF_TSTAMP        RKH_TRC_SIZEOF_TSTAMP/8</span>
<span class="preprocessor"></span><span class="preprocessor">#define TRAZER_SIZEOF_POINTER       RKH_TRC_SIZEOF_POINTER/8</span>
<span class="preprocessor"></span><span class="preprocessor">#define TRAZER_SIZEOF_NTIMER        RKH_TIM_SIZEOF_NTIMER/8</span>
<span class="preprocessor"></span><span class="preprocessor">#define TRAZER_SIZEOF_NBLOCK        RKH_MP_SIZEOF_NBLOCK/8</span>
<span class="preprocessor"></span><span class="preprocessor">#define TRAZER_SIZEOF_NELEM         RKH_RQ_SIZEOF_NELEM/8</span>
<span class="preprocessor"></span><span class="preprocessor">#define TRAZER_SIZEOF_ESIZE         RKH_SIZEOF_ESIZE/8</span>
<span class="preprocessor"></span><span class="preprocessor">#define TRAZER_EN_NSEQ              RKH_TRC_EN_NSEQ</span>
<span class="preprocessor"></span><span class="preprocessor">#define TRAZER_EN_CHK               RKH_TRC_EN_CHK</span>
<span class="preprocessor"></span><span class="preprocessor">#define TRAZER_EN_TSTAMP            RKH_TRC_EN_TSTAMP</span>
<span class="preprocessor"></span>

<span class="preprocessor">#if TRAZER_SIZEOF_SIG == 1</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> TRZE_T;
<span class="preprocessor">#elif TRAZER_SIZEOF_SIG == 2</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> TRZE_T;
<span class="preprocessor">#elif TRAZER_SIZEOF_SIG == 4</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> TRZE_T;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> TRZE_T;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>

<span class="preprocessor">#if TRAZER_SIZEOF_TSTAMP == 1</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> TRZTS_T;
<span class="preprocessor">#elif TRAZER_SIZEOF_TSTAMP == 2</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> TRZTS_T;
<span class="preprocessor">#elif TRAZER_SIZEOF_TSTAMP == 4</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> TRZTS_T;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> TRZTS_T;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>

<span class="preprocessor">#if TRAZER_SIZEOF_NBLOCK == 1</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> TRZNB_T;
<span class="preprocessor">#elif TRAZER_SIZEOF_NBLOCK == 2</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> TRZNB_T;
<span class="preprocessor">#elif TRAZER_SIZEOF_NBLOCK == 4</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> TRZNB_T;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> TRZNB_T;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>

<span class="preprocessor">#if TRAZER_SIZEOF_NELEM == 1</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> TRZNE_T;
<span class="preprocessor">#elif TRAZER_SIZEOF_NELEM == 2</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> TRZNE_T;
<span class="preprocessor">#elif TRAZER_SIZEOF_NELEM == 4</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> TRZNE_T;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> TRZNE_T;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>

<span class="preprocessor">#if TRAZER_SIZEOF_NTIMER == 1</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> TRZNT_T;
<span class="preprocessor">#elif TRAZER_SIZEOF_NTIMER == 2</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> TRZNT_T;
<span class="preprocessor">#elif TRAZER_SIZEOF_NTIMER == 4</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> TRZNT_T;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> TRZNT_T;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>

<span class="preprocessor">#if TRAZER_SIZEOF_ESIZE == 1</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> TRZES_T;
<span class="preprocessor">#elif TRAZER_SIZEOF_ESIZE == 2</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> TRZES_T;
<span class="preprocessor">#elif TRAZER_SIZEOF_ESIZE == 4</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> TRZES_T;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> TRZES_T;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>

<span class="preprocessor">#if TRAZER_EN_NSEQ == 1</span>
<span class="preprocessor"></span><span class="preprocessor">    #define get_nseq()      nseq = tr[ 1 ]</span>
<span class="preprocessor"></span><span class="preprocessor">    #define set_to_ts()     trb = tr + 2</span>
<span class="preprocessor"></span><span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">    #define get_nseq()      nseq = 0</span>
<span class="preprocessor"></span><span class="preprocessor">    #define set_to_ts()     trb = tr + 1</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>

<span class="preprocessor">#if TRAZER_EN_TSTAMP == 1</span>
<span class="preprocessor"></span><span class="preprocessor">    #define get_ts()        ( TRZTS_T )assemble( TRAZER_SIZEOF_TSTAMP )</span>
<span class="preprocessor"></span><span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">    #define get_ts()        0</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>

<span class="preprocessor">#define MKTR( id, gn, nm, fmt, fargs )  \</span>
<span class="preprocessor">                { id, gn, nm, fmt, fargs }</span>
<span class="preprocessor"></span>
<span class="preprocessor">#define MKS( sig, name )    \</span>
<span class="preprocessor">                { sig, name }</span>
<span class="preprocessor"></span>
<span class="preprocessor">#define MKO( obj, nm )                                  \</span>
<span class="preprocessor">                ++i;                                    \</span>
<span class="preprocessor">                objtbl[i].adr = (unsigned long)(obj);   \</span>
<span class="preprocessor">                objtbl[i].name = nm</span>
<span class="preprocessor"></span>
<span class="preprocessor">#define EOSIGTBL    \</span>
<span class="preprocessor">                { 0, CC( 0 ) }</span>
<span class="preprocessor"></span>

<span class="preprocessor">#define CTE( te )       ((const struct tre_t*)(te))</span>
<span class="preprocessor"></span>
<span class="keyword">typedef</span> <span class="keywordtype">char</span> *(*HDLR_T)( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre );

<span class="keyword">typedef</span> <span class="keyword">struct </span>tre_t
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> id;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *group;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt;
    HDLR_T fmt_args;
} TRE_T;


<span class="keyword">typedef</span> <span class="keyword">struct </span>symobj_t
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> adr;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
} SYMOBJ_T;


<span class="keyword">typedef</span> <span class="keyword">struct </span>symsig_t
{
    TRZE_T sig;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
} SYMSIG_T;


<span class="preprocessor">#if RKH_TRC_EN == 1 </span>
<span class="preprocessor"></span>
<span class="keyword">static</span> <span class="keywordtype">char</span> *h_none( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_epreg( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_ae( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_evt( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_1sym( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_2sym( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_symtrn( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_symrc( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_symu8( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_sym2u8( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_symevt( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_symnblk( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_2symnused( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_symnused( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_symobj( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_symsig( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_2symntick( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre ),
            *h_symntick( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre );


<span class="keyword">static</span> <span class="keyword">const</span> TRE_T traces[] =
{
    <span class="comment">/* --- Memory Pool (MP) ------------------ */</span>
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aaeebdc1b69736830bb77b8ff0efb1264e">RKH_TRCE_MP_INIT</a>,   <span class="stringliteral">&quot;MP&quot;</span>, <span class="stringliteral">&quot;INIT&quot;</span>, 
            <span class="stringliteral">&quot;mp=%s, nblock=%d&quot;</span>,             h_symnblk ),
    MKTR(    <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa85654ad05c94233e6281c0a796dcd8a8">RKH_TRCE_MP_GET</a>,   <span class="stringliteral">&quot;MP&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, 
            <span class="stringliteral">&quot;mp=%s, nfree=%d&quot;</span>,              h_symnblk ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa1263e486de6d597977d564caa00a8c76">RKH_TRCE_MP_PUT</a>,    <span class="stringliteral">&quot;MP&quot;</span>, <span class="stringliteral">&quot;PUT&quot;</span>, 
            <span class="stringliteral">&quot;mp=%s, nfree=%d&quot;</span>,              h_symnblk ),
    
    <span class="comment">/* --- Queue (RQ) ------------------------ */</span>
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa30b1415662d87fd96fbb822b211a8170">RKH_TRCE_RQ_INIT</a>,   <span class="stringliteral">&quot;RQ&quot;</span>, <span class="stringliteral">&quot;INIT&quot;</span>, 
            <span class="stringliteral">&quot;rq=%s, sma=%s, nelem=%d&quot;</span>,      h_2symnused ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa87d53354eb7bf471de765266e5ee41a8">RKH_TRCE_RQ_GET</a>,    <span class="stringliteral">&quot;RQ&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, 
            <span class="stringliteral">&quot;rq=%s, nused=%d&quot;</span>,              h_symnused ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa08249ee98684daf21b0830a8ef97f4a3">RKH_TRCE_RQ_FIFO</a>,   <span class="stringliteral">&quot;RQ&quot;</span>, <span class="stringliteral">&quot;POST_FIFO&quot;</span>, 
            <span class="stringliteral">&quot;rq=%s, nused=%d&quot;</span>,              h_symnused ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aafaa10f874d6f74abb02413ed63f1ea59">RKH_TRCE_RQ_LIFO</a>,   <span class="stringliteral">&quot;RQ&quot;</span>, <span class="stringliteral">&quot;POST_LIFO&quot;</span>, 
            <span class="stringliteral">&quot;rq=%s, nused=%d&quot;</span>,              h_symnused ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa1bc354fe3a85cf6562ca29a1e5877421">RKH_TRCE_RQ_FULL</a>,   <span class="stringliteral">&quot;RQ&quot;</span>, <span class="stringliteral">&quot;FULL&quot;</span>, 
            <span class="stringliteral">&quot;rq=%s&quot;</span>,                        h_1sym ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa39ab743938886b027bef48113cde02af">RKH_TRCE_RQ_DPT</a>,    <span class="stringliteral">&quot;RQ&quot;</span>, <span class="stringliteral">&quot;DEPLETE&quot;</span>, 
            <span class="stringliteral">&quot;rq=%s&quot;</span>,                        h_1sym ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aac6ef5f04b72046898308a0737f3a8afc">RKH_TRCE_RQ_GET_LAST</a>,   <span class="stringliteral">&quot;RQ&quot;</span>, <span class="stringliteral">&quot;GET_LAST&quot;</span>, 
            <span class="stringliteral">&quot;rq=%s&quot;</span>,                        h_1sym ),

    <span class="comment">/* --- State Machine Application (SMA) --- */</span>
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa8c2d12ab50a7474cabdbb1f0830749c7">RKH_TRCE_SMA_ACT</a>,   <span class="stringliteral">&quot;SMA&quot;</span>, <span class="stringliteral">&quot;ACTIVATE&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s&quot;</span>,                       h_1sym ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa07ece5a231347b9a6110c24b6338fe30">RKH_TRCE_SMA_TERM</a>,  <span class="stringliteral">&quot;SMA&quot;</span>, <span class="stringliteral">&quot;TERMINATE&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s&quot;</span>,                       h_1sym ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa4fa747a26ff1c50712858743d0b9fdfb">RKH_TRCE_SMA_GET</a>,   <span class="stringliteral">&quot;SMA&quot;</span>, <span class="stringliteral">&quot;GET_EVENT&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, sig=%s&quot;</span>,               h_symevt ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aafda30bca593fc8b17e21262f36fba643">RKH_TRCE_SMA_FIFO</a>,  <span class="stringliteral">&quot;SMA&quot;</span>, <span class="stringliteral">&quot;POST_FIFO&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, sig=%s&quot;</span>,               h_symevt ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa5e0ca3da0b19b0418ea0d60e03359c3e">RKH_TRCE_SMA_LIFO</a>,  <span class="stringliteral">&quot;SMA&quot;</span>, <span class="stringliteral">&quot;POST_LIFO&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, sig=%s&quot;</span>,               h_symevt ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa5c24b4d0e624dc6bddb29e2b90bf1bd6">RKH_TRCE_SMA_REG</a>,   <span class="stringliteral">&quot;SMA&quot;</span>, <span class="stringliteral">&quot;REGISTER&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, prio=%d&quot;</span>,              h_symu8 ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa99aae7d0cc64fe35609c6feb5bf314e9">RKH_TRCE_SMA_UNREG</a>, <span class="stringliteral">&quot;SMA&quot;</span>, <span class="stringliteral">&quot;UNREGISTER&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, prio=%d&quot;</span>,              h_symu8 ),

    <span class="comment">/* --- State machine (SM) ---------------- */</span>
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aaca95226774f3fc35720a6ba4b59eb774">RKH_TRCE_SM_INIT</a>,   <span class="stringliteral">&quot;SM&quot;</span>, <span class="stringliteral">&quot;INIT&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, istate=%s&quot;</span>,            h_2sym ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aac1f0c30dc6cad1937e404e8ed69da464">RKH_TRCE_SM_CLRH</a>,   <span class="stringliteral">&quot;SM&quot;</span>, <span class="stringliteral">&quot;CLEAR_HIST&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, hist=%s&quot;</span>,              h_2sym ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa28f0b27de6edd3d172c06bbfe8e39b94">RKH_TRCE_SM_DCH</a>,    <span class="stringliteral">&quot;SM&quot;</span>, <span class="stringliteral">&quot;DISPATCH&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, sig=%s&quot;</span>,               h_symevt ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa3020a7926425ba3a5f98dc6d58f5cb37">RKH_TRCE_SM_TRN</a>,    <span class="stringliteral">&quot;SM&quot;</span>, <span class="stringliteral">&quot;TRANSITION&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, sstate=%s, tstate=%s&quot;</span>, h_symtrn ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aaa3afbe14afa16595110732b6fb2cd175">RKH_TRCE_SM_STATE</a>,  <span class="stringliteral">&quot;SM&quot;</span>, <span class="stringliteral">&quot;CURRENT_STATE&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, state=%s&quot;</span>,             h_2sym ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa7937db005f96efb7f98eda0fb74c2955">RKH_TRCE_SM_ENSTATE</a>,<span class="stringliteral">&quot;SM&quot;</span>, <span class="stringliteral">&quot;ENTRY_STATE&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, state=%s&quot;</span>,             h_2sym ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa2e88125c92a5be8bd8010a9fccda0cb1">RKH_TRCE_SM_EXSTATE</a>,<span class="stringliteral">&quot;SM&quot;</span>, <span class="stringliteral">&quot;EXIT_STATE&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, state=%s&quot;</span>,             h_2sym ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa44901bcb453a051452f5c0542ae301f3">RKH_TRCE_SM_NENEX</a>,  <span class="stringliteral">&quot;SM&quot;</span>, <span class="stringliteral">&quot;NUM_EN_EX&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, nentry=%d, nexit=%d&quot;</span>,  h_sym2u8 ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aae7b9e24a8455606e4656fff860e62d54">RKH_TRCE_SM_NTRNACT</a>,<span class="stringliteral">&quot;SM&quot;</span>, <span class="stringliteral">&quot;NUM_TRN_ACT&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, ntrnaction=%d&quot;</span>,        h_symu8 ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa1e850e8bcf1cfdf0ef461ef718d17bf5">RKH_TRCE_SM_CSTATE</a>, <span class="stringliteral">&quot;SM&quot;</span>, <span class="stringliteral">&quot;COMP_STATE&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, state=%s&quot;</span>,             h_2sym ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa4f0ac93ccefe6254d1733e53999c0a85">RKH_TRCE_SM_DCH_RC</a>, <span class="stringliteral">&quot;SM&quot;</span>, <span class="stringliteral">&quot;DISPATCH_RCODE&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, retcode=%s&quot;</span>,           h_symrc ),

    <span class="comment">/* --- Timer (TIM) ----------------------- */</span>
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa8f621389b5bcb81a9d639d544201e9d5">RKH_TRCE_TIM_INIT</a>,  <span class="stringliteral">&quot;TIM&quot;</span>, <span class="stringliteral">&quot;INIT&quot;</span>, 
            <span class="stringliteral">&quot;timer=%s, sig=%s&quot;</span>,             h_symevt ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa25d0bee0a17e2345e06196d2668fd1ae">RKH_TRCE_TIM_START</a>, <span class="stringliteral">&quot;TIM&quot;</span>, <span class="stringliteral">&quot;START&quot;</span>, 
            <span class="stringliteral">&quot;timer=%s, sma=%s, ntick=%d&quot;</span>,   h_2symntick ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aaba1a59295dd1e9a7c95838ba91a41b0b">RKH_TRCE_TIM_RESTART</a>,<span class="stringliteral">&quot;TIM&quot;</span>, <span class="stringliteral">&quot;RESTART&quot;</span>, 
            <span class="stringliteral">&quot;timer=%s, ntick=%5d&quot;</span>,          h_symntick ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa07d502f57deda9f0b9c6d6a886375a33">RKH_TRCE_TIM_STOP</a>,  <span class="stringliteral">&quot;TIM&quot;</span>, <span class="stringliteral">&quot;STOP&quot;</span>, 
            <span class="stringliteral">&quot;timer=%s&quot;</span>,                     h_1sym ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aac67d1706c74f11931b58b3e407dcdb8f">RKH_TRCE_TIM_TOUT</a>,  <span class="stringliteral">&quot;TIM&quot;</span>, <span class="stringliteral">&quot;TIMEOUT&quot;</span>, 
            <span class="stringliteral">&quot;timer=%s&quot;</span>,                     h_1sym ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aad1eea498e92054cd03c87be8412c9057">RKH_TRCE_TIM_REM</a>,   <span class="stringliteral">&quot;TIM&quot;</span>, <span class="stringliteral">&quot;REMOVED&quot;</span>, 
            <span class="stringliteral">&quot;timer=%s&quot;</span>,                     h_1sym ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aad22268c2b6f4a05f6ccaa6ef6002ada4">RKH_TRCE_TIM_ATTEMPT_STOP</a>,  <span class="stringliteral">&quot;TIM&quot;</span>, <span class="stringliteral">&quot;ATTEMPT_STOP&quot;</span>, 
            <span class="stringliteral">&quot;timer=%s&quot;</span>,                     h_1sym ),

    <span class="comment">/* --- Framework (RKH) ------------------- */</span>
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aac4ec27e9ac2bdde55e729f9db1ac92be">RKH_TRCE_RKH_EN</a>,    <span class="stringliteral">&quot;RKH&quot;</span>, <span class="stringliteral">&quot;ENTER&quot;</span>, 
            <span class="stringliteral">&quot;&quot;</span>,                             h_none ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa72733b590eddf9a75d4b9208ad35672f">RKH_TRCE_RKH_EX</a>,    <span class="stringliteral">&quot;RKH&quot;</span>, <span class="stringliteral">&quot;EXIT&quot;</span>, 
            <span class="stringliteral">&quot;&quot;</span>,                             h_none ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa7cf338e46a6493bd4c235d5774f1210d">RKH_TRCE_RKH_EPREG</a>, <span class="stringliteral">&quot;RKH&quot;</span>, <span class="stringliteral">&quot;EPOOL_REG&quot;</span>, 
            <span class="stringliteral">&quot;epix =%d, ssize=%d, esize=%d&quot;</span>, h_epreg ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa75faaabf6127512cf05fb98bbc8c0231">RKH_TRCE_RKH_AE</a>,    <span class="stringliteral">&quot;RKH&quot;</span>, <span class="stringliteral">&quot;ALLOC_EVENT&quot;</span>, 
            <span class="stringliteral">&quot;esize=%d, sig=%s&quot;</span>,             h_ae ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aab744163a803cc2a8c24d88fc7050eb4e">RKH_TRCE_RKH_GC</a>,    <span class="stringliteral">&quot;RKH&quot;</span>, <span class="stringliteral">&quot;GC&quot;</span>, 
            <span class="stringliteral">&quot;sig=%s&quot;</span>,                       h_evt ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa8613c601fcf2dd797afac3ec6ef792a5">RKH_TRCE_RKH_GCR</a>,   <span class="stringliteral">&quot;RKH&quot;</span>, <span class="stringliteral">&quot;GC_RECYCLE&quot;</span>, 
            <span class="stringliteral">&quot;sig=%s&quot;</span>,                       h_evt ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa92ca02b111001268a59b72f142e796cf">RKH_TRCE_RKH_DEFER</a>, <span class="stringliteral">&quot;RKH&quot;</span>, <span class="stringliteral">&quot;DEFER&quot;</span>, 
            <span class="stringliteral">&quot;rq=%s, sig=%s&quot;</span>,                h_symevt ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aa373ac7222d82cd3f7bba7b102c755607">RKH_TRCE_RKH_RCALL</a>, <span class="stringliteral">&quot;RKH&quot;</span>, <span class="stringliteral">&quot;RECALL&quot;</span>, 
            <span class="stringliteral">&quot;sma=%s, sig=%s&quot;</span>,               h_symevt ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aab88f505e35ee563b56c01693e2ed5b45">RKH_TRCE_OBJ</a>,       <span class="stringliteral">&quot;RKH&quot;</span>, <span class="stringliteral">&quot;SYM_OBJ&quot;</span>, 
            <span class="stringliteral">&quot;obj=0x%08X, sym=%s&quot;</span>,           h_symobj ),
    MKTR(   <a class="code" href="rkhtrc_8h.html#a4705ca08d69d80441ecb18b0c9f36c8aaa17b33a66d33f9501db6b7f7a7c5a574">RKH_TRCE_SIG</a>,       <span class="stringliteral">&quot;RKH&quot;</span>, <span class="stringliteral">&quot;SYM_SIG&quot;</span>, 
            <span class="stringliteral">&quot;sig=%d, sym=%s&quot;</span>,               h_symsig )
};


<span class="keyword">static</span> <span class="keyword">const</span> SYMSIG_T sigtbl[] =            <span class="comment">/* signal symbol table */</span>
{
    MKS( ZERO,  <span class="stringliteral">&quot;ZERO&quot;</span>  ),
    MKS( ONE,   <span class="stringliteral">&quot;ONE&quot;</span>   ),
    MKS( TWO,   <span class="stringliteral">&quot;TWO&quot;</span>   ),
    MKS( THREE, <span class="stringliteral">&quot;THREE&quot;</span> ),
    MKS( FOUR,  <span class="stringliteral">&quot;FOUR&quot;</span>  ),
    MKS( FIVE,  <span class="stringliteral">&quot;FIVE&quot;</span>  ),
    MKS( SIX,   <span class="stringliteral">&quot;SIX&quot;</span>   ),
    MKS( TERM,  <span class="stringliteral">&quot;TERM&quot;</span>  ),

    EOSIGTBL
};


<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *rctbl[] =                <span class="comment">/* dispatch ret code table */</span>
{
    <span class="stringliteral">&quot;RKH_OK&quot;</span>,
    <span class="stringliteral">&quot;RKH_INPUT_NOT_FOUND&quot;</span>,
    <span class="stringliteral">&quot;RKH_CONDITION_NOT_FOUND&quot;</span>,
    <span class="stringliteral">&quot;RKH_GUARD_FALSE&quot;</span>,
    <span class="stringliteral">&quot;RKH_UNKNOWN_STATE&quot;</span>,
    <span class="stringliteral">&quot;RKH_EXCEED_HCAL_LEVEL&quot;</span>,
    <span class="stringliteral">&quot;RKH_EXCEED_TRC_SEGS&quot;</span>
};


<span class="preprocessor">#if TRAZER_SIZEOF_TSTAMP == 2</span>
<span class="preprocessor"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *trheader = <span class="stringliteral">&quot;%5d [%3d] %-4s| %-15s : &quot;</span>;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *trheader = <span class="stringliteral">&quot;%10d [%3d] %-4s| %-15s : &quot;</span>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>

<span class="preprocessor">#define PARSER_MAX_SIZE_BUF         64</span>
<span class="preprocessor"></span>

<span class="keyword">enum</span>
{
    PARSER_WFLAG, PARSER_COLLECT, PARSER_ESCAPING
};


<span class="keyword">static</span> SYMOBJ_T objtbl[ 128 ];      <span class="comment">/* object symbol table */</span>
<span class="keyword">static</span> rkhui8_t *trb;               <span class="comment">/* points to trace event buffer */</span>
<span class="keyword">static</span> <span class="keywordtype">char</span> fmt[ 128 ];
<span class="keyword">extern</span> FILE *fdbg;

<span class="keyword">extern</span> <a class="code" href="struct_r_k_h_t___t.html" title="Defines the data structure used to maintain information that allows the timer-handling facility to up...">RKHT_T</a> my_timer;
<span class="keyword">static</span> rkhui8_t state = PARSER_WFLAG;
<span class="keyword">static</span> rkhui8_t tr[ PARSER_MAX_SIZE_BUF ], *ptr, trix;
<span class="keyword">static</span> <span class="keywordtype">char</span> symstr[ 16 ];


<span class="keyword">static</span>
<span class="keywordtype">void</span>
make_symtbl( <span class="keywordtype">void</span> )
{
    <span class="keywordtype">int</span> i = -1;

    MKO( my,            <span class="stringliteral">&quot;my&quot;</span>        );
    MKO( &amp;my-&gt;equeue,   <span class="stringliteral">&quot;my_queue&quot;</span>  );
    MKO( &amp;S1,           <span class="stringliteral">&quot;S1&quot;</span>        );
    MKO( &amp;S11,          <span class="stringliteral">&quot;S11&quot;</span>       );
    MKO( &amp;S111,         <span class="stringliteral">&quot;S111&quot;</span>      );
    MKO( &amp;S112,         <span class="stringliteral">&quot;S112&quot;</span>      );
    MKO( &amp;S12,          <span class="stringliteral">&quot;S12&quot;</span>       );
    MKO( &amp;S2,           <span class="stringliteral">&quot;S2&quot;</span>        );
    MKO( &amp;S3,           <span class="stringliteral">&quot;S3&quot;</span>        );
    MKO( &amp;S31,          <span class="stringliteral">&quot;S31&quot;</span>       );
    MKO( &amp;S32,          <span class="stringliteral">&quot;S32&quot;</span>       );
    MKO( &amp;C1,           <span class="stringliteral">&quot;C1&quot;</span>        );
    MKO( &amp;C2,           <span class="stringliteral">&quot;C2&quot;</span>        );
    MKO( &amp;J,            <span class="stringliteral">&quot;J&quot;</span>         );
    MKO( &amp;DH,           <span class="stringliteral">&quot;DH&quot;</span>        );
    MKO( &amp;H,            <span class="stringliteral">&quot;H&quot;</span>         );

    MKO( 0,             CC( 0 ) );
}


<span class="keyword">static</span>
<span class="keyword">const</span> <span class="keywordtype">char</span> *
map_obj( <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> adr )
{
    <span class="keyword">const</span> SYMOBJ_T *p;

    <span class="keywordflow">for</span>( p = objtbl; p-&gt;name != 0; ++p )
        <span class="keywordflow">if</span>( p-&gt;adr == adr )
            <span class="keywordflow">return</span> p-&gt;name;
    <span class="keywordflow">return</span> CC( 0 );
}


<span class="keyword">static</span>
<span class="keyword">const</span> <span class="keywordtype">char</span> *
map_sig( TRZE_T sig )
{
    <span class="keyword">const</span> SYMSIG_T *p;

    <span class="keywordflow">for</span>( p = sigtbl; p-&gt;name != 0; ++p )
        <span class="keywordflow">if</span>( p-&gt;sig == sig )
            <span class="keywordflow">return</span> p-&gt;name;
    <span class="keywordflow">return</span> CC( 0 );
}


<span class="keyword">static</span>
<span class="keyword">const</span>
TRE_T *
find_trevt( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <span class="keywordtype">id</span> )
{
    <span class="keyword">const</span> TRE_T *p;

    <span class="keywordflow">for</span>( p = traces; p &lt; traces + RKH_TRCE_USER; ++p )
        <span class="keywordflow">if</span>( p-&gt;id == <span class="keywordtype">id</span> )
            <span class="keywordflow">return</span> p;

    <span class="keywordflow">return</span> ( TRE_T* )0;
}


<span class="keyword">static</span>
<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>
assemble( <span class="keywordtype">int</span> size )
{
    <span class="keywordtype">int</span> n, sh;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> d;

    <span class="keywordflow">for</span>( d = 0, n = size, sh = 0; n; --n, sh += 8  )
        d |= ( <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> )( *trb++ &lt;&lt; sh );
    <span class="keywordflow">return</span> d;
}


<span class="keyword">static</span>
<span class="keywordtype">char</span> *
assemble_str( <span class="keywordtype">void</span>  )
{
    <span class="keywordtype">char</span> *p;

    <span class="keywordflow">for</span>( p = symstr; *trb != <span class="charliteral">&#39;\0&#39;</span>; ++p, ++trb )
        *p = *trb;
    
    *p = <span class="charliteral">&#39;\0&#39;</span>;
    <span class="keywordflow">return</span> symstr;
}


<span class="keywordtype">char</span> *
h_none( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    (void)tre;

    strcpy( fmt, <span class="stringliteral">&quot; &quot;</span> );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_1sym( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> obj;

    obj = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    sprintf( fmt, CTE( tre )-&gt;fmt, map_obj( obj ) );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_2sym( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> obj1, obj2;

    obj1 = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    obj2 = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    sprintf( fmt, CTE( tre )-&gt;fmt, map_obj( obj1 ), map_obj( obj2 ) );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_symtrn( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> smaobj, ssobj, tsobj;

    smaobj = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    ssobj = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    tsobj = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    sprintf( fmt, CTE( tre )-&gt;fmt, map_obj( smaobj ), map_obj( ssobj ), 
                    tsobj == 0 ? map_obj( ssobj ) : map_obj( tsobj ) );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_symrc( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> obj;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> u8;

    obj = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    u8 = (<span class="keywordtype">unsigned</span> char)assemble( <span class="keyword">sizeof</span>( <span class="keywordtype">char</span> ) );
    sprintf( fmt, CTE( tre )-&gt;fmt, map_obj( obj ), rctbl[ u8 ] );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_symu8( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> obj;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> u8;

    obj = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    u8 = (<span class="keywordtype">unsigned</span> char)assemble( <span class="keyword">sizeof</span>( <span class="keywordtype">char</span> ) );
    sprintf( fmt, CTE( tre )-&gt;fmt, map_obj( obj ), u8 );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_symnblk( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> obj;
    TRZNB_T nblock;

    obj = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    nblock = (TRZNB_T)assemble( <span class="keyword">sizeof</span>( TRZNB_T ) );
    sprintf( fmt, CTE( tre )-&gt;fmt, map_obj( obj ), nblock );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_2symnused( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> obj1, obj2;
    TRZNE_T nelem;

    obj1 = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    obj2 = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    nelem = (TRZNE_T)assemble( <span class="keyword">sizeof</span>( TRZNE_T ) );
    sprintf( fmt, CTE( tre )-&gt;fmt, map_obj( obj1 ), map_obj( obj2 ), nelem );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_symnused( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> obj;
    TRZNE_T nelem;

    obj = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    nelem = (TRZNE_T)assemble( <span class="keyword">sizeof</span>( TRZNE_T ) );
    sprintf( fmt, CTE( tre )-&gt;fmt, map_obj( obj ), nelem );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_2symntick( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> obj1, obj2;
    TRZNT_T ntick;

    obj1 = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    obj2 = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    ntick = (TRZNT_T)assemble( <span class="keyword">sizeof</span>( TRZNT_T ) );
    sprintf( fmt, CTE( tre )-&gt;fmt, map_obj( obj1 ), map_obj( obj2 ), ntick );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_symntick( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> obj1;
    TRZNT_T ntick;

    obj1 = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    ntick = (TRZNT_T)assemble( <span class="keyword">sizeof</span>( TRZNT_T ) );
    sprintf( fmt, CTE( tre )-&gt;fmt, map_obj( obj1 ), ntick );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_sym2u8( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> obj;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> u8_1, u8_2;

    obj = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    u8_1 = (<span class="keywordtype">unsigned</span> char)assemble( <span class="keyword">sizeof</span>( <span class="keywordtype">char</span> ) );
    u8_2 = (<span class="keywordtype">unsigned</span> char)assemble( <span class="keyword">sizeof</span>( <span class="keywordtype">char</span> ) );
    sprintf( fmt, CTE( tre )-&gt;fmt, map_obj( obj ), u8_1, u8_2 );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_evt( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    TRZE_T e;

    e = (TRZE_T)assemble( <span class="keyword">sizeof</span>( TRZE_T ) );
    sprintf( fmt, CTE( tre )-&gt;fmt, map_sig( e ) );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_symevt( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> obj;
    TRZE_T e;

    obj = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    e = (TRZE_T)assemble( <span class="keyword">sizeof</span>( TRZE_T ) );
    sprintf( fmt, CTE( tre )-&gt;fmt, map_obj( obj ), map_sig( e ) );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_epreg( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> u32;
    TRZES_T esize;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> u8;

    u8 = (<span class="keywordtype">unsigned</span> char)assemble( <span class="keyword">sizeof</span>( <span class="keywordtype">char</span> ) );
    u32 = (<span class="keywordtype">unsigned</span> long)assemble( <span class="keyword">sizeof</span>( <span class="keywordtype">long</span> ) );
    esize = (TRZES_T)assemble( <span class="keyword">sizeof</span>( TRZES_T ) );
    sprintf( fmt, CTE( tre )-&gt;fmt, u8, u32, esize  );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_ae( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    TRZES_T esize;
    TRZE_T e;

    esize = (TRZES_T)assemble( <span class="keyword">sizeof</span>( TRZES_T ) );
    e = (TRZE_T)assemble( <span class="keyword">sizeof</span>( TRZE_T ) );
    sprintf( fmt, CTE( tre )-&gt;fmt, esize, map_sig( e ) );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_symobj( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> obj;
    <span class="keywordtype">char</span> *s;

    obj = (<span class="keywordtype">unsigned</span> long)assemble( TRAZER_SIZEOF_POINTER );
    s = assemble_str();
    sprintf( fmt, CTE( tre )-&gt;fmt, obj, s );
    <span class="keywordflow">return</span> fmt;
}


<span class="keywordtype">char</span> *
h_symsig( <span class="keyword">const</span> <span class="keywordtype">void</span> *tre )
{
    TRZE_T e;
    <span class="keywordtype">char</span> *s;

    e = (TRZE_T)assemble( <span class="keyword">sizeof</span>( TRZE_T ) );
    s = assemble_str();
    sprintf( fmt, CTE( tre )-&gt;fmt, e, s );
    <span class="keywordflow">return</span> fmt;
}


<span class="keyword">static</span>
<span class="keywordtype">void</span>
parser_init( <span class="keywordtype">void</span> )
{
    ptr = tr;
    trix = 0;
}


<span class="keyword">static</span>
<span class="keywordtype">void</span>
parser_collect( rkhui8_t d )
{
    <span class="keywordflow">if</span>( ++trix &gt; PARSER_MAX_SIZE_BUF )
    {
        state = PARSER_WFLAG;
        <span class="keywordflow">return</span>;
    }
    *ptr++ = d;
}


<span class="keyword">static</span>
<span class="keywordtype">int</span>
parser_chk( <span class="keywordtype">void</span> )
{
<span class="preprocessor">#if TRAZER_EN_CHK == 1</span>
<span class="preprocessor"></span>    rkhui8_t *p, chk;
    <span class="keywordtype">int</span> i;

    <span class="keywordflow">for</span>( chk = 0, p = tr, i = trix; i--; ++p )
        chk = (rkhui8_t)( chk + *p );
    <span class="keywordflow">return</span> chk == 0;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> 1;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}


<span class="keyword">static</span>
<span class="keywordtype">void</span>
parser( <span class="keywordtype">void</span> )
{
    <span class="keyword">const</span> TRE_T *ftr;           <span class="comment">/* received trace event */</span>
    TRZTS_T ts;
    rkhui8_t nseq;

    <span class="keywordflow">if</span>( ( ftr = find_trevt( tr[ 0 ] ) ) != ( TRE_T* )0 )
    {
        <span class="keywordflow">if</span>( ftr-&gt;fmt_args != ( HDLR_T )0 )
        {
            get_nseq();
            set_to_ts();        <span class="comment">/* from timestamp field */</span>
            ts = get_ts();
            printf( trheader, ts, nseq, ftr-&gt;group, ftr-&gt;name );
            fprintf( fdbg, trheader, ts, nseq, ftr-&gt;group, ftr-&gt;name );
            printf( <span class="stringliteral">&quot;%s\n&quot;</span>, (*ftr-&gt;fmt_args)( CTE( ftr ) ) );
            fprintf( fdbg, <span class="stringliteral">&quot;%s\n&quot;</span>, fmt );
        }
        <span class="keywordflow">return</span>;
    }
    
    printf( <span class="stringliteral">&quot;Unknown trace event = %s (%d), group = %s\n&quot;</span>,  
                                        ftr-&gt;name, ftr-&gt;group, ftr - traces );
    fprintf( fdbg, <span class="stringliteral">&quot;Unknown trace event = %s (%d), group = %s\n&quot;</span>,   
                                        ftr-&gt;name, ftr-&gt;group, ftr - traces );
}

<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="keywordtype">void</span> 
trazer_parse( rkhui8_t d )
{
<span class="preprocessor">#if RKH_TRC_EN == 1 </span>
<span class="preprocessor"></span>    <span class="keywordflow">switch</span>( state )
    {
        <span class="keywordflow">case</span> PARSER_WFLAG:
            <span class="keywordflow">if</span>( d == RKH_FLG )
            {
                parser_init();
                state = PARSER_COLLECT;
            }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> PARSER_COLLECT:
            <span class="keywordflow">if</span>( d == RKH_FLG )
            {
                <span class="keywordflow">if</span>( trix &gt; 0 &amp;&amp; parser_chk() )
                    parser();
                parser_init();
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( d == RKH_ESC )
                state = PARSER_ESCAPING;
            <span class="keywordflow">else</span>
                parser_collect( d );
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> PARSER_ESCAPING:
            <span class="keywordflow">if</span>( d == RKH_FLG )
            {
                parser_init();
                state = PARSER_COLLECT;
            }
            <span class="keywordflow">else</span>
            {
                parser_collect( (rkhui8_t)(d ^ RKH_XOR) );
                state = PARSER_COLLECT;
            }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
            <span class="keywordflow">break</span>;
    }
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    ( void )d;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}


<span class="keywordtype">void</span>
trazer_init( <span class="keywordtype">void</span> )
{
<span class="preprocessor">#if TRAZER_EN == 1 </span>
<span class="preprocessor"></span>    printf( <span class="stringliteral">&quot;---- RKH trace log session ----\n\n&quot;</span> );
    printf( <span class="stringliteral">&quot;Date = &quot;</span>__DATE__ __TIME__<span class="stringliteral">&quot;\n&quot;</span> );
    printf( <span class="stringliteral">&quot;Number of trace events = %d\n&quot;</span>, TRAZER_NTRE );
    printf( <span class="stringliteral">&quot;Number of trace groups = %d\n&quot;</span>, TRAZER_NTRG );
    printf( <span class="stringliteral">&quot;Configurations = \n\n&quot;</span> );
    printf( <span class="stringliteral">&quot;   TRAZER_SIZEOF_SIG     = %d\n&quot;</span>, TRAZER_SIZEOF_SIG );
    printf( <span class="stringliteral">&quot;   TRAZER_SIZEOF_TSTAMP  = %d\n&quot;</span>, TRAZER_SIZEOF_TSTAMP );
    printf( <span class="stringliteral">&quot;   TRAZER_SIZEOF_POINTER = %d\n&quot;</span>, TRAZER_SIZEOF_POINTER );
    printf( <span class="stringliteral">&quot;   TRAZER_SIZEOF_NTIMER  = %d\n&quot;</span>, TRAZER_SIZEOF_NTIMER );
    printf( <span class="stringliteral">&quot;   TRAZER_SIZEOF_NBLOCK  = %d\n&quot;</span>, TRAZER_SIZEOF_NBLOCK );
    printf( <span class="stringliteral">&quot;   TRAZER_SIZEOF_NELEM   = %d\n&quot;</span>, TRAZER_SIZEOF_NELEM );
    printf( <span class="stringliteral">&quot;   TRAZER_SIZEOF_ESIZE   = %d\n&quot;</span>, TRAZER_SIZEOF_ESIZE );
    printf( <span class="stringliteral">&quot;   TRAZER_EN_NSEQ        = %d\n&quot;</span>, TRAZER_EN_NSEQ );
    printf( <span class="stringliteral">&quot;   TRAZER_EN_CHK         = %d\n&quot;</span>, TRAZER_EN_CHK );
    printf( <span class="stringliteral">&quot;   TRAZER_EN_TSTAMP      = %d\n&quot;</span>, TRAZER_EN_TSTAMP );
    printf( <span class="stringliteral">&quot;   RKH_TRC_ALL           = %d\n&quot;</span>, <a class="code" href="rkhcfg_8h.html#a485d6d3a1e65dc63aa81857dba541997">RKH_TRC_ALL</a> );
    printf( <span class="stringliteral">&quot;   RKH_TRC_EN_MP         = %d\n&quot;</span>, <a class="code" href="rkhcfg_8h.html#acde5a28204f1a7a303663af32beef0e9">RKH_TRC_EN_MP</a> );
    printf( <span class="stringliteral">&quot;   RKH_TRC_EN_RQ         = %d\n&quot;</span>, <a class="code" href="rkhcfg_8h.html#acec02c16205d1228e46b2b2bfe52ec0a">RKH_TRC_EN_RQ</a> );
    printf( <span class="stringliteral">&quot;   RKH_TRC_EN_SMA        = %d\n&quot;</span>, <a class="code" href="rkhcfg_8h.html#a9dd1a756634cb8bbf7ddae104a8b20c2">RKH_TRC_EN_SMA</a> );
    printf( <span class="stringliteral">&quot;   RKH_TRC_EN_TIM        = %d\n&quot;</span>, <a class="code" href="rkhcfg_8h.html#a254c4c6b7d6b2c86e2ceb5d78846a8e3">RKH_TRC_EN_TIM</a> );
    printf( <span class="stringliteral">&quot;   RKH_TRC_EN_SM         = %d\n&quot;</span>, <a class="code" href="rkhcfg_8h.html#a04637ebe74b7f5181fcf47058cbb01d2">RKH_TRC_EN_SM</a> );
    printf( <span class="stringliteral">&quot;   RKH_TRC_EN_RKH        = %d\n&quot;</span>, <a class="code" href="rkhcfg_8h.html#a92242d21f21820a56c925b74ba9ba0d4">RKH_TRC_EN_RKH</a> );
    printf( <span class="stringliteral">&quot;\n---- BEGIN TRACE SESSION ----\n\n&quot;</span> );

    fprintf( fdbg, <span class="stringliteral">&quot;---- RKH trace log session ----\n&quot;</span> );
    fprintf( fdbg, <span class="stringliteral">&quot;date : &quot;</span>__DATE__ __TIME__<span class="stringliteral">&quot;\n&quot;</span> );
    fprintf( fdbg, <span class="stringliteral">&quot;Number of trace events = %d\n&quot;</span>, TRAZER_NTRE );
    fprintf( fdbg, <span class="stringliteral">&quot;Number of trace groups = %d\n&quot;</span>, TRAZER_NTRG );
    fprintf( fdbg, <span class="stringliteral">&quot;Configurations = \n\n&quot;</span> );
    fprintf( fdbg, <span class="stringliteral">&quot;   TRAZER_SIZEOF_SIG     = %d\n&quot;</span>, TRAZER_SIZEOF_SIG );
    fprintf( fdbg, <span class="stringliteral">&quot;   TRAZER_SIZEOF_TSTAMP  = %d\n&quot;</span>, TRAZER_SIZEOF_TSTAMP );
    fprintf( fdbg, <span class="stringliteral">&quot;   TRAZER_SIZEOF_POINTER = %d\n&quot;</span>, TRAZER_SIZEOF_POINTER );
    fprintf( fdbg, <span class="stringliteral">&quot;   TRAZER_SIZEOF_NTIMER  = %d\n&quot;</span>, TRAZER_SIZEOF_NTIMER );
    fprintf( fdbg, <span class="stringliteral">&quot;   TRAZER_SIZEOF_NBLOCK  = %d\n&quot;</span>, TRAZER_SIZEOF_NBLOCK );
    fprintf( fdbg, <span class="stringliteral">&quot;   TRAZER_SIZEOF_NELEM   = %d\n&quot;</span>, TRAZER_SIZEOF_NELEM );
    fprintf( fdbg, <span class="stringliteral">&quot;   TRAZER_SIZEOF_ESIZE   = %d\n&quot;</span>, TRAZER_SIZEOF_ESIZE );
    fprintf( fdbg, <span class="stringliteral">&quot;   TRAZER_EN_NSEQ        = %d\n&quot;</span>, TRAZER_EN_NSEQ );
    fprintf( fdbg, <span class="stringliteral">&quot;   TRAZER_EN_CHK         = %d\n&quot;</span>, TRAZER_EN_CHK );
    fprintf( fdbg, <span class="stringliteral">&quot;   TRAZER_EN_TSTAMP      = %d\n&quot;</span>, TRAZER_EN_TSTAMP );
    fprintf( fdbg, <span class="stringliteral">&quot;   RKH_TRC_ALL           = %d\n&quot;</span>, <a class="code" href="rkhcfg_8h.html#a485d6d3a1e65dc63aa81857dba541997">RKH_TRC_ALL</a> );
    fprintf( fdbg, <span class="stringliteral">&quot;   RKH_TRC_EN_MP         = %d\n&quot;</span>, <a class="code" href="rkhcfg_8h.html#acde5a28204f1a7a303663af32beef0e9">RKH_TRC_EN_MP</a> );
    fprintf( fdbg, <span class="stringliteral">&quot;   RKH_TRC_EN_RQ         = %d\n&quot;</span>, <a class="code" href="rkhcfg_8h.html#acec02c16205d1228e46b2b2bfe52ec0a">RKH_TRC_EN_RQ</a> );
    fprintf( fdbg, <span class="stringliteral">&quot;   RKH_TRC_EN_SMA        = %d\n&quot;</span>, <a class="code" href="rkhcfg_8h.html#a9dd1a756634cb8bbf7ddae104a8b20c2">RKH_TRC_EN_SMA</a> );
    fprintf( fdbg, <span class="stringliteral">&quot;   RKH_TRC_EN_TIM        = %d\n&quot;</span>, <a class="code" href="rkhcfg_8h.html#a254c4c6b7d6b2c86e2ceb5d78846a8e3">RKH_TRC_EN_TIM</a> );
    fprintf( fdbg, <span class="stringliteral">&quot;   RKH_TRC_EN_SM         = %d\n&quot;</span>, <a class="code" href="rkhcfg_8h.html#a04637ebe74b7f5181fcf47058cbb01d2">RKH_TRC_EN_SM</a> );
    fprintf( fdbg, <span class="stringliteral">&quot;   RKH_TRC_EN_RKH        = %d\n&quot;</span>, <a class="code" href="rkhcfg_8h.html#a92242d21f21820a56c925b74ba9ba0d4">RKH_TRC_EN_RKH</a> );
    fprintf( fdbg, <span class="stringliteral">&quot;\n---- BEGIN TRACE SESSION ----\n\n&quot;</span> );

    make_symtbl();
<span class="preprocessor">#endif</span>
<span class="preprocessor">}</span>
</pre></div> </div></div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 9 2012 13:05:37 for RKH by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
