<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>RKH: 1. Instantiating the state machine (and defining the top state)</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">RKH
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_usage.html">Representing a state machine: step by step</a>      </li>
      <li class="navelem"><a class="el" href="representing.html">Representing the state machine</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">1. Instantiating the state machine (and defining the top state) </div>  </div>
</div>
<div class="contents">
<div class="textblock"><div class="image">
<img src="rkh_bunner.jpg" alt="rkh_bunner.jpg"/>
</div>
<p><br/>
 Prev: <a class="el" href="representing.html">Representing the state machine</a><br/>
 Next: <a class="el" href="rep_cs.html">Instantiating the composite states</a><br/>
<br/>
</p>
<p>A state machine application (SMA) a.k.a active object, is defined with the <a class="el" href="rkh_8h.html#ae6c326c33b1cc4acf2529c628ba8c2aa" title="Declare and allocate a SMA (active object) derived from RKHSMA_T. Also, initializes and assigns a sta...">RKH_SMA_CREATE()</a> macro and declared with the <a class="el" href="rkh_8h.html#aab4c88b9429479d470bde8e05b2feead" title="This macro declares a opaque pointer to previously created state machine application (SMA) to be used...">RKH_SMA_DCLR()</a> macro. Frequently, each state machine application is encapsulated inside a dedicated source file (.c file), from which the <a class="el" href="rkh_8h.html#ae6c326c33b1cc4acf2529c628ba8c2aa" title="Declare and allocate a SMA (active object) derived from RKHSMA_T. Also, initializes and assigns a sta...">RKH_SMA_CREATE()</a> macro is used, thus the structure definition is in fact entirely encapsulated in its module and is inaccessible to the rest of the application. However, as a general rule, the SMA must be declared inside a header file (.h file) by means of <a class="el" href="rkh_8h.html#aab4c88b9429479d470bde8e05b2feead" title="This macro declares a opaque pointer to previously created state machine application (SMA) to be used...">RKH_SMA_DCLR()</a> macro. This macro declares a opaque pointer to SMA to be used as a global object. This global pointer represent the state machine in the application. The state machine pointers are "opaque" because they cannot access the whole state machine structure, but only the part inherited from the <a class="el" href="struct_r_k_h_s_m_a___t.html" title="Describes the SMA (active object in UML).">RKHSMA_T</a> structure. The power of an "opaque" pointer is that it allows to completely hide the definition of the state machine structure and make it inaccessible to the rest of the application.</p>
<p>In the UML specification, every state machine has a top state (the abstract root of every state machine hierarchy), which contains all the other elements of the entire state machine. RKH provides the top state using the macro <a class="el" href="rkh_8h.html#ae6c326c33b1cc4acf2529c628ba8c2aa" title="Declare and allocate a SMA (active object) derived from RKHSMA_T. Also, initializes and assigns a sta...">RKH_SMA_CREATE()</a>. requently, <a class="el" href="rkh_8h.html#ae6c326c33b1cc4acf2529c628ba8c2aa" title="Declare and allocate a SMA (active object) derived from RKHSMA_T. Also, initializes and assigns a sta...">RKH_SMA_CREATE()</a> is used within state-machine's module (.c file), thus the structure definition is in fact entirely encapsulated in its module and is inaccessible to the rest of the application. However, use the <a class="el" href="rkh_8h.html#aab4c88b9429479d470bde8e05b2feead" title="This macro declares a opaque pointer to previously created state machine application (SMA) to be used...">RKH_SMA_DCLR()</a> macro to declare a "opaque" pointer to that state machine application structure to be used in the rest of the application but hiding the proper definition. <a class="el" href="struct_r_k_h_s_m_a___t.html" title="Describes the SMA (active object in UML).">RKHSMA_T</a> is not intended to be instantiated directly, but rather serves as the base structure for derivation of state machines in the application code.</p>
<p>The <a class="el" href="rep_sm.html#its">Figure 2</a> highlights the top state and its relevant aspects. Also, shows its implementation using the RKH framework.</p>
<p><br/>
 <a class="anchor" id="its"></a></p>
<div class="image">
<img src="its.png" alt="its.png"/>
<div class="caption">
Figure 2 - Top state of state machine <code>my</code> </div></div>
<p><br/>
</p>
<p><b>Defining the state machine</b> <br/>
 </p>
<div class="fragment"><pre class="fragment">    <span class="comment">//  my.c: state machine application&#39;s module</span>

(1) <a class="code" href="rkh_8h.html#ae6c326c33b1cc4acf2529c628ba8c2aa" title="Declare and allocate a SMA (active object) derived from RKHSMA_T. Also, initializes and assigns a sta...">RKH_SMA_CREATE</a>(     
(2)                     MYSM_T, 
(3)                     0, 
(4)                     my, 
(5)                     0, 
(6)                     <a class="code" href="rkh_8h.html#a243967727eeb1814b24badfeda7b25b7af9de2b2b683900d16cf6a78acb458eda">HCAL</a>, 
(7)                     &amp;S1, 
(8)                     my_init, 
(9)                     NULL );
</pre></div><p><b>Declaring the state machine</b> <br/>
 </p>
<div class="fragment"><pre class="fragment">    <span class="comment">//  my.h: state-machine application&#39;s header file</span>

    <span class="keyword">typedef</span> <span class="keyword">struct</span>
    {
        <a class="code" href="struct_r_k_h_s_m_a___t.html" title="Describes the SMA (active object in UML).">RKHSMA_T</a> sm;    <span class="comment">// base structure</span>
        rkhuint8 x;     <span class="comment">// private member</span>
        rkhuint8 y;     <span class="comment">// private member</span>
(10)} MYSM_T;           <span class="comment">// SMA derived from RKHSMA_T structure</span>

(11) <a class="code" href="rkh_8h.html#aab4c88b9429479d470bde8e05b2feead" title="This macro declares a opaque pointer to previously created state machine application (SMA) to be used...">RKH_SMA_DCLR</a>( my );
</pre></div><p>Explanation</p>
<ul>
<li>(1) Declares and allocates a SMA (a.k.a active object) derived from <a class="el" href="struct_r_k_h_s_m_a___t.html" title="Describes the SMA (active object in UML).">RKHSMA_T</a>. </li>
<li>(2) As said before, <code>MYSM_T</code> represents the SMA object struture. </li>
<li>(3) <code>0</code> is the SMA ID. This number allows to uniquely identify a SMA. This argument is optional, thus it could be eliminated in compile-time with RKH_SMA_EN_ID = 0. </li>
<li>(4) <code>my</code> is the name of SMA. Also, it represents the top state of state diagram. </li>
<li>(5) <code>0</code> is the SMA priority. A unique priority number must be assigned to each SMA from 0 to RKH_LOWEST_PRIO. The lower the number, the higher the priority. </li>
<li>(6) the <code>my</code> state machine is defined as a hierarchical state machine. The available property options are enumerated in RKH_HPPTY_T enumeration in the <b><a class="el" href="rkh_8h.html" title="RKH platform-independent interface.">rkh.h</a></b> file. </li>
<li>(7) <code>S1</code> is the initial state. </li>
<li>(8) the <code>my_init()</code> function defines the topmost initial transition in the <code>my</code> state machine. The function prototype is defined as RKHINIT_T. This argument is (optional), thus it could be declared as NULL. </li>
<li>(9) not used. </li>
<li>(10)The <code>MYSM_T</code> defines the SMA object structure <code>my</code>. On the other hand, almost every SMA must also store other "extended-state" information. You supply this additional information by means of data members enlisted after the base structure member <code>sm</code>. Please note that the <a class="el" href="struct_r_k_h_s_m_a___t.html" title="Describes the SMA (active object in UML).">RKHSMA_T</a> member <code>sm</code> is defined as the <b>FIRST</b> member of the derived struct. <a class="el" href="struct_r_k_h_s_m_a___t.html" title="Describes the SMA (active object in UML).">RKHSMA_T</a> is not intended to be instantiated directly, but rather serves as the base structure for derivation of state machines in the application code. </li>
<li>(11)Declares a opaque pointer to <code>my</code> SMA to be used as a global object.</li>
</ul>
<p><br/>
 Prev: <a class="el" href="representing.html">Representing the state machine</a><br/>
 Next: <a class="el" href="rep_cs.html">Instantiating the composite states</a><br/>
<br/>
 </p>
</div></div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 9 2012 13:05:36 for RKH by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
