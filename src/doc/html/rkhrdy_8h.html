<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>RKH: rkhrdy.h File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">RKH
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Defines</a>  </div>
  <div class="headertitle">
<div class="title">rkhrdy.h File Reference</div>  </div>
</div>
<div class="contents">

<p>Native priority management.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="rkhcfg_8h_source.html">rkhcfg.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="rkhtype_8h_source.html">rkhtype.h</a>&quot;</code><br/>
</div>
<p><a href="rkhrdy_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_r_k_h_r_g___t.html">RKHRG_T</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">SMA ready table.  <a href="struct_r_k_h_r_g___t.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rkhrdy_8h.html#ab4c805018ada5dd7732cecf9bce22225">rkh_rdy_is_empty</a>(rg)&#160;&#160;&#160;( (rg).grp == 0 )</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This macro evaluates to TRUE if all SMAs are not ready to run.  <a href="#ab4c805018ada5dd7732cecf9bce22225"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rkhrdy_8h.html#a8a93c5eb6c2a9ad46bf37cc21a4f5eea">rkh_rdy_isnot_empty</a>(rg)&#160;&#160;&#160;( (rg).grp != 0 )</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This macro evaluates to TRUE if any SMA is ready to run.  <a href="#a8a93c5eb6c2a9ad46bf37cc21a4f5eea"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rkhrdy_8h.html#a82ef2b607622f8a11891a328ce466624">rkh_rdy_ins</a>(rg, p)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Making a SMA ready-to-run inserting it into the ready list.  <a href="#a82ef2b607622f8a11891a328ce466624"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rkhrdy_8h.html#a8080ba46f2cccbc43e098aa9a090092e">rkh_rdy_rem</a>(rg, p)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Removing a SMA from the ready list.  <a href="#a8080ba46f2cccbc43e098aa9a090092e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rkhrdy_8h.html#ab5ba4ef6e05e88daeff78572d9f7cab6">rkh_rdy_findh</a>(rg, p)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Finding the highest priority SMA ready to run.  <a href="#ab5ba4ef6e05e88daeff78572d9f7cab6"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Native priority management. </p>
<p>Each SMA is assigned a unique priority level between 0 and RKH_LOWEST_PRIO. Each SMA that is ready to run is placed in a ready list consisting of two variables, rkhrg.grp and rkhrg.tbl[]. SMA priorities are grouped (8 SMA per group) in rkhrg.grp. Each bit in rkhrg.grp is used to indicate whenever any SMA in a group is ready to run. When a task is ready to run it also sets its corresponding bit in the ready table, rkhrg.tbl[]. The size of rkhrg.tbl[] depends on RKH_LOWEST_PRIO (see <a class="el" href="rkhcfg_8h.html" title="RKH user configuration.">rkhcfg.h</a>).</p>
<p>SMA's priority = | 0 | 0 | Y | Y | Y | X | X | X |</p>
<p>Y's: bit position in rkhrg.grp and index into rkhrg.tbl[RKH_LOWEST_PRIO / 8 + 1]<br/>
 X's: bit position in rkhrg.tbl[RKH_LOWEST_PRIO / 8 + 1]</p>
<p>The lower 3 bits (X's) of the SMA's priority are used to determine the bit position in rkhrg.tbl[], while the next three most significant bits (Y's) are used to determine the index into rkhrg.tbl[]. Note that rkh_maptbl[] is a table in ROM, used to equate an index from 0 to 7 to a bit mask. <br/>
<br/>
</p>
<p>To determine which priority (and thus which SMA) will run next, the scheduler determines the lowest priority number that has its bit set in rkhrg.tbl[]. The relationship between rkhrg.grp and rkhrg.tbl[] is given by the following rules:</p>
<p>Bit 0 in rkhrg.grp is 1 when any bit in rkhrg.tbl[0] is 1.<br/>
 Bit 1 in rkhrg.grp is 1 when any bit in rkhrg.tbl[1] is 1.<br/>
 Bit 2 in rkhrg.grp is 1 when any bit in rkhrg.tbl[2] is 1.<br/>
 Bit 3 in rkhrg.grp is 1 when any bit in rkhrg.tbl[3] is 1.<br/>
 Bit 4 in rkhrg.grp is 1 when any bit in rkhrg.tbl[4] is 1.<br/>
 Bit 5 in rkhrg.grp is 1 when any bit in rkhrg.tbl[5] is 1.<br/>
 Bit 6 in rkhrg.grp is 1 when any bit in rkhrg.tbl[6] is 1.<br/>
 Bit 7 in rkhrg.grp is 1 when any bit in rkhrg.tbl[7] is 1.</p>
<p>[JL] </p>

<p>Definition in file <a class="el" href="rkhrdy_8h_source.html">rkhrdy.h</a>.</p>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="ab4c805018ada5dd7732cecf9bce22225"></a><!-- doxytag: member="rkhrdy.h::rkh_rdy_is_empty" ref="ab4c805018ada5dd7732cecf9bce22225" args="(rg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define rkh_rdy_is_empty</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">rg</td><td>)</td>
          <td>&#160;&#160;&#160;( (rg).grp == 0 )</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This macro evaluates to TRUE if all SMAs are not ready to run. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">rg</td><td>ready group. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="rkhrdy_8h_source.html#l00137">137</a> of file <a class="el" href="rkhrdy_8h_source.html">rkhrdy.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8a93c5eb6c2a9ad46bf37cc21a4f5eea"></a><!-- doxytag: member="rkhrdy.h::rkh_rdy_isnot_empty" ref="a8a93c5eb6c2a9ad46bf37cc21a4f5eea" args="(rg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define rkh_rdy_isnot_empty</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">rg</td><td>)</td>
          <td>&#160;&#160;&#160;( (rg).grp != 0 )</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This macro evaluates to TRUE if any SMA is ready to run. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">rg</td><td>ready group. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="rkhrdy_8h_source.html#l00148">148</a> of file <a class="el" href="rkhrdy_8h_source.html">rkhrdy.h</a>.</p>

</div>
</div>
<a class="anchor" id="a82ef2b607622f8a11891a328ce466624"></a><!-- doxytag: member="rkhrdy.h::rkh_rdy_ins" ref="a82ef2b607622f8a11891a328ce466624" args="(rg, p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define rkh_rdy_ins</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">rg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">p&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">(rg).grp |= rkh_maptbl[(p) &gt;&gt; 3];               \
                (rg).tbl[(p) &gt;&gt; 3] |= <a class="code" href="rkh_8h.html#acdd6484fff4fc6ae3c4106f9492ec421" title="rkh_maptbl[] is a table in ROM, used to equate an index from 0 to 7 to a bit mask.">rkh_maptbl</a>[(p) &amp; 0x07]
</pre></div>
<p>Making a SMA ready-to-run inserting it into the ready list. </p>
<p>The lower 3 bits of the SMA's priority are used to determine the bit position in rkhrg.tbl[], while the next three most significant bits are used to determine the index into rkhrg.tbl[]. Note that rkh_maptbl[] is a table in ROM, used to equate an index from 0 to 7 to a bit mask.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">rg</td><td>ready group. </td></tr>
    <tr><td class="paramname">p</td><td>number of SMA's priotity. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="rkhrdy_8h_source.html#l00165">165</a> of file <a class="el" href="rkhrdy_8h_source.html">rkhrdy.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8080ba46f2cccbc43e098aa9a090092e"></a><!-- doxytag: member="rkhrdy.h::rkh_rdy_rem" ref="a8080ba46f2cccbc43e098aa9a090092e" args="(rg, p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define rkh_rdy_rem</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">rg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">p&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">if</span>(((rg).tbl[(p)&gt;&gt;3] &amp;= ~rkh_maptbl[(p)&amp;0x07])==0)  \
                    (rg).grp &amp;= ~rkh_maptbl[(p)&gt;&gt;3]
</pre></div>
<p>Removing a SMA from the ready list. </p>
<p>Clears the ready bit of the SMA in rkhrg.tbl[] and clears the bit in rkhrg.grp only if all SMAs in a group are not ready to run, i.e. all bits in rkhrg.tbl[prio &gt;&gt; 3] are 0.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">rg</td><td>ready group. </td></tr>
    <tr><td class="paramname">p</td><td>number of SMA's priotity. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="rkhrdy_8h_source.html#l00182">182</a> of file <a class="el" href="rkhrdy_8h_source.html">rkhrdy.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab5ba4ef6e05e88daeff78572d9f7cab6"></a><!-- doxytag: member="rkhrdy.h::rkh_rdy_findh" ref="ab5ba4ef6e05e88daeff78572d9f7cab6" args="(rg, p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define rkh_rdy_findh</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">rg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">p&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">(p) = rkh_unmaptbl[ (rg).grp ];                 \
                (p) = (rkhui8_t)(((p) &lt;&lt; 3) +                   \
                        (rkhui8_t)rkh_unmaptbl[(rg).tbl[(p)]])
</pre></div>
<p>Finding the highest priority SMA ready to run. </p>
<p>Another table lookup is performed, rather than scanning through the table starting with rkhrg.tbl[0] to find the highest priority task ready to run. rkh_unmaptbl[256] is a priority resolution table. Eight bits are used to represent when tasks are ready in a group. The least significant bit has the highest priority. Using this byte to index the table returns the bit position of the highest priority bit set, a number between 0 and 7.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">rg</td><td>ready group. </td></tr>
    <tr><td class="paramname">p</td><td>the found highest priority is assigned to <em>p</em>. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="rkhrdy_8h_source.html#l00202">202</a> of file <a class="el" href="rkhrdy_8h_source.html">rkhrdy.h</a>.</p>

</div>
</div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 9 2012 13:05:35 for RKH by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
