<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>RKH: 5. Declaring the state machine&#39;s objects</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">RKH
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_usage.html">Representing a state machine: step by step</a>      </li>
      <li class="navelem"><a class="el" href="representing.html">Representing the state machine</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">5. Declaring the state machine's objects </div>  </div>
</div>
<div class="contents">
<div class="textblock"><div class="image">
<img src="rkh_bunner.jpg" alt="rkh_bunner.jpg"/>
</div>
<p><br/>
 Prev: <a class="el" href="rep_cjh.html">Declaring the pseudostates</a><br/>
 Next: <a class="el" href="rep_act.html">Declaring the actions</a><br/>
<br/>
</p>
<p>The <a class="el" href="my_h.html">"my.h"</a> file contains the definitions of objet structures (state machine, states, and pseudostates) and other facilities shared among the components of the application. See the <a class="el" href="my_h.html">"my.h"</a> file. The following listing shows the <a class="el" href="my_h.html">"my.h"</a> header file, which illuminates some important aspects of implementing state machines with RKH.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#ifndef __MY_H__</span>
<span class="preprocessor"></span><span class="preprocessor">#define __MY_H__</span>
<span class="preprocessor"></span>

(1) #include <span class="stringliteral">&quot;rkh.h&quot;</span>


    <span class="comment">/*</span>
<span class="comment">    Signals</span>
<span class="comment">     */</span>

(2) <span class="keyword">enum</span>
    {
        ZERO,       <span class="comment">/* press the key &#39;0&#39; on the keyboard */</span>
        ONE,        <span class="comment">/* press the key &#39;1&#39; on the keyboard */</span>
        TWO,        <span class="comment">/* press the key &#39;2&#39; on the keyboard */</span>
        THREE,      <span class="comment">/* press the key &#39;3&#39; on the keyboard */</span>
        FOUR,       <span class="comment">/* press the key &#39;4&#39; on the keyboard */</span>
        FIVE,       <span class="comment">/* press the key &#39;5&#39; on the keyboard */</span>
        SIX,        <span class="comment">/* press the key &#39;6&#39; on the keyboard */</span>
        TERM        <span class="comment">/* press the key escape on the keyboard */</span>
    };


    <span class="keyword">typedef</span> <span class="keyword">struct</span>
    {
(3)     <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> event; <span class="comment">/* base structure */</span>
(4)     rkhuint16 ts;   <span class="comment">/* parameter &#39;ts&#39;. Private member */</span>
    } MYEVT_T;          <span class="comment">/* derived from RKHEVT_T structure */</span>


    <span class="keyword">typedef</span> <span class="keyword">struct</span>
    {
        <a class="code" href="struct_r_k_h_s_m_a___t.html" title="Describes the SMA (active object in UML).">RKHSMA_T</a> sma;   <span class="comment">/* base structure */</span>
        rkhui8_t x;     <span class="comment">/* private member */</span>
        rkhui8_t y;     <span class="comment">/* private member */</span>
(5) } MYSM_T;           <span class="comment">/* SMA derived from RKHSMA_T structure */</span>


<span class="comment">/*  Declare the state machine */</span>

(6) <a class="code" href="rkh_8h.html#aab4c88b9429479d470bde8e05b2feead" title="This macro declares a opaque pointer to previously created state machine application (SMA) to be used...">RKH_SMA_DCLR</a>( my );


<span class="comment">/*  Defines states and pseudostates. */</span>

(7) <a class="code" href="rkh_8h.html#ab856423b3e65be3f55b7df3b2984e5fe" title="Declares a previously created state/pseudostate to be used as a global object.">RKH_DCLR_COMP_STATE</a>     S1,S3,S11;
    <a class="code" href="rkh_8h.html#a483ad8fd1a11d5b823e58a2884e40f22" title="Declares a previously created state/pseudostate to be used as a global object.">RKH_DCLR_BASIC_STATE</a>    S2,S31,S32,S111,S112,S12;
    <a class="code" href="rkh_8h.html#ae15f169feaafe7cf7e335e24e76039b9" title="Declares a previously created state/pseudostate to be used as a global object.">RKH_DCLR_COND_STATE</a>     C1,C2;
    <a class="code" href="rkh_8h.html#a2862a673eba565cd2888ca5fb3405a38" title="Declares a previously created state/pseudostate to be used as a global object.">RKH_DCLR_JUNC_STATE</a>     J;
    <a class="code" href="rkh_8h.html#a042e46c64f90aa08a92db9e9d30e1959" title="Declares a previously created state/pseudostate to be used as a global object.">RKH_DCLR_DHIST_STATE</a>    DH;
    <a class="code" href="rkh_8h.html#aa618e2849fbd748f672bd5e0b3b6bb16" title="Declares a previously created state/pseudostate to be used as a global object.">RKH_DCLR_SHIST_STATE</a>    H;


<span class="preprocessor">#endif</span>
</pre></div><ul>
<li>(1) RKH interfaces.</li>
</ul>
<ul>
<li>(2) The events in the <code>my</code> state machine have been identified in the state diagram in <a class="el" href="_usage.html#fig1">fig1</a> Figure 1. Note that events consist really of two parts. The part of the event called the signal conveys the type of the occurrence (what happened). For example, the ONE signal conveys the arrival of a press key '1'. An event can also contain additional quantitative information about the occurrence in form of event parameters. In <code>my</code> state machine, all signals are accompanied by the parameter (ts) that contain the quantitative information as to timestamp. In RKH, events are represented as instances of the <a class="el" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> structure provided by the framework. Specifically, the <a class="el" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> structure contains the member e, to represent the signal of that event. Event parameters are added in the process of inheritance. Because events are explicitly shared among most of the application components, it is convenient to declare them in the separate header file <a class="el" href="my_h.html">"my.h"</a>.</li>
</ul>
<ul>
<li>(3-4) The MYEVT_T structure declares an event with the parameter "ts". Such nesting of structures always aligns the data member <a class="el" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> at the beginning of every instance of the derived structure. In particular, this alignment lets treat a pointer to the derived MYEVT_T structure as a pointer to the <a class="el" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> base structure. Consequently, can always safely pass a pointer to MYEVT_T to any C function that expects a pointer to <a class="el" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a>.</li>
</ul>
<ul>
<li>(5) The MYSM_T defines the SMA object structure <code>my</code>. On the other hand, almost every SMA must also store other "extended-state" information. You supply this additional information by means of data members enlisted after the base structure member sm. Please note that the <a class="el" href="struct_r_k_h_s_m_a___t.html" title="Describes the SMA (active object in UML).">RKHSMA_T</a> member sm is defined as the FIRST member of the derived struct. <a class="el" href="struct_r_k_h_s_m_a___t.html" title="Describes the SMA (active object in UML).">RKHSMA_T</a> is not intended to be instantiated directly, but rather serves as the base structure for derivation of state machines in the application code.</li>
</ul>
<ul>
<li>(6) Declares a opaque pointer to <code>my</code> SMA to be used as a global object.</li>
</ul>
<ul>
<li>(7) Defines the states and pseudostates using the corresponding macros listed above: <br/>
 <br/>
<ul>
<li><a class="el" href="rkh_8h.html#ab856423b3e65be3f55b7df3b2984e5fe" title="Declares a previously created state/pseudostate to be used as a global object.">RKH_DCLR_COMP_STATE</a>: composite state.</li>
<li><a class="el" href="rkh_8h.html#a483ad8fd1a11d5b823e58a2884e40f22" title="Declares a previously created state/pseudostate to be used as a global object.">RKH_DCLR_BASIC_STATE</a>: basic state.</li>
<li><a class="el" href="rkh_8h.html#ae15f169feaafe7cf7e335e24e76039b9" title="Declares a previously created state/pseudostate to be used as a global object.">RKH_DCLR_COND_STATE</a>: conditional pseudostate.</li>
<li><a class="el" href="rkh_8h.html#a2862a673eba565cd2888ca5fb3405a38" title="Declares a previously created state/pseudostate to be used as a global object.">RKH_DCLR_JUNC_STATE</a>: junction pseudostate.</li>
<li><a class="el" href="rkh_8h.html#a042e46c64f90aa08a92db9e9d30e1959" title="Declares a previously created state/pseudostate to be used as a global object.">RKH_DCLR_DHIST_STATE</a>: deep history pseudostate.</li>
<li><a class="el" href="rkh_8h.html#aa618e2849fbd748f672bd5e0b3b6bb16" title="Declares a previously created state/pseudostate to be used as a global object.">RKH_DCLR_SHIST_STATE</a>: shallow history pseudostate.</li>
</ul>
</li>
</ul>
<p><br/>
 Prev: <a class="el" href="rep_cjh.html">Declaring the pseudostates</a><br/>
 Next: <a class="el" href="rep_act.html">Declaring the actions</a><br/>
<br/>
 </p>
</div></div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 9 2012 13:05:36 for RKH by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
