<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>RKH: 3. Declaring the basic states</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">RKH
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_usage.html">Representing a state machine: step by step</a>      </li>
      <li class="navelem"><a class="el" href="representing.html">Representing the state machine</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">3. Declaring the basic states </div>  </div>
</div>
<div class="contents">
<div class="textblock"><div class="image">
<img src="rkh_bunner.jpg" alt="rkh_bunner.jpg"/>
</div>
<p><br/>
 Prev: <a class="el" href="rep_cs.html">Instantiating the composite states</a><br/>
 Next: <a class="el" href="rep_cjh.html">Declaring the pseudostates</a><br/>
<br/>
</p>
<p>A basic state (also called substate) is defined with the <a class="el" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE()</a> macro and declared with the <a class="el" href="rkh_8h.html#a483ad8fd1a11d5b823e58a2884e40f22" title="Declares a previously created state/pseudostate to be used as a global object.">RKH_DCLR_BASIC_STATE()</a> macro. Frequently, each state machine and its states (superstates and substates) are encapsulated inside a dedicated source file (.c file), from which the <a class="el" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE()</a> macro is used. As will demostrates the use of <a class="el" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE()</a> macro and its arguments is very similar to <a class="el" href="rkh_8h.html#acc24b2221cd374e66732a09fb24b56ce" title="This macro creates a composite state.">RKH_CREATE_COMP_STATE()</a> macro.</p>
<p>The <a class="el" href="rep_bs.html#is2">Figure 7</a> highlights the basic states "S2". Also, shows its implementation using the RKH framework.</p>
<p><br/>
 <a class="anchor" id="is2"></a></p>
<div class="image">
<img src="is2.png" alt="is2.png"/>
<div class="caption">
Figure 7 - basic state "S2"</div></div>
<p> <b>Defining the basic state "S2"</b> <br/>
 </p>
<div class="fragment"><pre class="fragment">(1) <span class="comment">//  my.c: state-machine&#39;s module</span>

(2) <a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S2, 
(3)                         0, 
(4)                         NULL, 
(5)                         NULL, 
(6)                         RKH_ROOT, 
(7)                         NULL );
</pre></div><p><b>Declaring the basic state "S2"</b> <br/>
 </p>
<div class="fragment"><pre class="fragment"><span class="comment">//  my.h: state-machine&#39;s header file</span>

<a class="code" href="rkh_8h.html#a483ad8fd1a11d5b823e58a2884e40f22" title="Declares a previously created state/pseudostate to be used as a global object.">RKH_DCLR_BASIC_STATE</a>( S2 );
</pre></div><p>Explanation</p>
<ul>
<li>(1) Frequently, each state machine and its states are encapsulated inside a dedicated source file (.c file), from which the <a class="el" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE()</a> macro is used. </li>
<li>(2) <code>S2</code> is the state name. Represents a substate structure. </li>
<li>(3) <code>0</code> is the value of state ID. </li>
<li>(4) the entry action is unused, therefore it is declared as NULL. </li>
<li>(5) the exit action is unused, therefore it is declared as NULL. </li>
<li>(6) <code>RKH_ROOT</code> is the parent state of <code>S2</code>. If a state has no explicit superstate means that it is implicitly nested in the "top" state, and the parent state is defined by means of RKH_ROOT macro. The "top" state is a UML concept that denotes the ultimate root of the state hierarchy in a hierarchical state machine. </li>
<li>(7) <code>the</code> event preprocessor action is unused, therefore it is declared as NULL. Before sending the arrived event to state machine, it can be previously processed using the event preprocessor function. An action function takes the state machine pointer and the event pointer as arguments. The first parameter is optional in compile-time according to RKH_SMA_EN_PPRO_ARG_SMA macro. Example: <div class="fragment"><pre class="fragment"><span class="keyword">static</span>
<a class="code" href="rkhevt_8h.html#a8a78cec3a9dfc2336bd084c221e15e10">RKHE_T</a>
in_keyb( <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> *pe )
{
    <span class="keywordflow">if</span>( pe-&gt;<a class="code" href="struct_r_k_h_e_v_t___t.html#ace79af9a2276cf72d7accf7f8f2c957e">e</a> &gt;= 0 &amp;&amp; pe-&gt;<a class="code" href="struct_r_k_h_e_v_t___t.html#ace79af9a2276cf72d7accf7f8f2c957e">e</a> &lt;= 9 )
        <span class="keywordflow">return</span> DECIMAL;
    <span class="keywordflow">if</span>( pe-&gt;<a class="code" href="struct_r_k_h_e_v_t___t.html#ace79af9a2276cf72d7accf7f8f2c957e">e</a> == <span class="charliteral">&#39;.&#39;</span> )
        <span class="keywordflow">return</span> POINT;
    <span class="keywordflow">else</span>
        <span class="keywordflow">return</span> pe-&gt;<a class="code" href="struct_r_k_h_e_v_t___t.html#ace79af9a2276cf72d7accf7f8f2c957e">e</a>;
}
</pre></div></li>
</ul>
<ul>
<li>(7) <p>Aditionally, by means of single inheritance in C it could be used as state's abstract data. Aditionally, implementing the single inheritance in C is very simply by literally embedding the base type, RKHPPRO_T in this case, as the first member of the derived structure.</p>
<p>This argument is optional, thus it could be declared as NULL.</p>
<p>Example:</p>
<div class="fragment"><pre class="fragment">    <span class="keyword">static</span>
    <a class="code" href="rkhevt_8h.html#a8a78cec3a9dfc2336bd084c221e15e10">RKHE_T</a>
    preprocessor( <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> *pe )
    {
        ...
    }
  
    <span class="keyword">typedef</span> <span class="keyword">struct</span>
    {
        <a class="code" href="rkhitl_8h.html#a3f1afca9ba9935082740bf026862729c" title="Event preprocessor.">RKHPPRO_T</a> <a class="code" href="struct_r_k_h_s_b_s_c___t.html#a9fedacf35966d15f063c3ba208dddd3d" title="Points to event preprocessor.">prepro</a>;   <span class="comment">// extend the RKHPPRO_T class</span>
        <span class="keywordtype">unsigned</span> min:4;
        <span class="keywordtype">unsigned</span> max:4;
        <span class="keywordtype">char</span> *buff;
    } SDATA_T;

    <span class="keyword">static</span> <span class="keyword">const</span> SDATA_T option = { preprocessor, 4, 8, token1 };

    <a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S111, 0, set_x_1, 
                    NULL, &amp;S11, preprocessor ); 
    <a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S22, 0, set_x_4, 
                    NULL, &amp;S2, (<a class="code" href="rkhitl_8h.html#a3f1afca9ba9935082740bf026862729c" title="Event preprocessor.">RKHPPRO_T</a>*)&amp;option ); 
</pre></div> </li>
</ul>
<p><br/>
 The following figures, <a class="el" href="rep_bs.html#is111_s112">Figure 8</a>, <a class="el" href="rep_bs.html#is12">Figure 9</a>, and <a class="el" href="rep_bs.html#is31_s32">Figure 10</a> highlights the basic states "S111", "S112", "S31", "S32", and "S12" respectively. Also, shows its implementation using the RKH framework.</p>
<p><br/>
 <a class="anchor" id="is111_s112"></a></p>
<div class="image">
<img src="is111_s112.png" alt="is111_s112.png"/>
<div class="caption">
Figure 8 - basic states "S111", and "S112"</div></div>
<p> <br/>
 <a class="anchor" id="is12"></a></p>
<div class="image">
<img src="is12.png" alt="is12.png"/>
<div class="caption">
Figure 9 - basic state "S12"</div></div>
<p> <br/>
 <a class="anchor" id="is31_s32"></a></p>
<div class="image">
<img src="is31_s32.png" alt="is31_s32.png"/>
<div class="caption">
Figure 10 - basic states "S31", and "S32"</div></div>
<p> <br/>
 Prev: <a class="el" href="rep_cs.html">Instantiating the composite states</a><br/>
 Next: <a class="el" href="rep_cjh.html">Declaring the pseudostates</a><br/>
<br/>
 </p>
</div></div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 9 2012 13:05:36 for RKH by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
